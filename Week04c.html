<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Week4: ggplot2 plotting environment</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs\style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 02</li>
    <li>
      <a href="Week02a.html">Data types</a>
    </li>
    <li>
      <a href="Week02b.html">Reading and writing data files</a>
    </li>
    <li>
      <a href="Week02c.html">Working with date objects</a>
    </li>
    <li>
      <a href="Week02d.html">Exploring and cleaning dataframes using base functions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 03</li>
    <li>
      <a href="Week03a.html">Manipulating dataframes with dplyr</a>
    </li>
    <li>
      <a href="Week03b.html">Tidying/reshaping tables using tidyr</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 04</li>
    <li>
      <a href="Week03c.html">Joining data tables</a>
    </li>
    <li>
      <a href="Week03d.html">Working with string objects</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 05</li>
    <li>
      <a href="Week04a.html">The base plotting environment</a>
    </li>
    <li>
      <a href="Week04b.html">The lattice plotting environment</a>
    </li>
    <li>
      <a href="Week04c.html">The ggplot plotting environment</a>
    </li>
    <li>
      <a href="Week04d.html">Manipulating colors in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Univariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 06</li>
    <li>
      <a href="Week05a.html">Visualizing univariate data</a>
    </li>
    <li>
      <a href="Week05b.html">Comparing univariate data distributions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 07</li>
    <li>
      <a href="Week06a.html">Theoretical Q-Q plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 08</li>
    <li>
      <a href="Week07a.html">Fits and residuals</a>
    </li>
    <li>
      <a href="Week07b.html">Spread-location plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 09</li>
    <li>
      <a href="Week08a.html">Re-expressing data</a>
    </li>
    <li>
      <a href="Week08b.html">Letter value summaries</a>
    </li>
    <li>
      <a href="Week08c.html">The Two R’s of EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bivariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 10</li>
    <li>
      <a href="Week09a.html">Bivariate analysis</a>
    </li>
    <li>
      <a href="Week09b.html">Resistant lines</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 11</li>
    <li>
      <a href="Week10a.html">The third R of EDA: Residuals</a>
    </li>
    <li>
      <a href="Week10b.html">Detecting discontinuities in the data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 12</li>
    <li>
      <a href="http://mgimond.github.io/Tutorial--Stats/05_regression.htmll">Details of the OLS regression method (optional reading)</a>
    </li>
    <li>
      <a href="Week11a.html">Two-way tables</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 13</li>
    <li>
      <a href="Week12a.html">Creating maps in R</a>
    </li>
    <li class="dropdown-header">Connecting to relational databases</li>
  </ul>
</li>
<li>
  <a href="Data.html">Datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Week4: ggplot2 plotting environment</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#data">Data</a><ul>
<li><a href="#dataset-dat1">Dataset <code>dat1</code></a></li>
<li><a href="#dataset-dat2">Dataset <code>dat2</code></a></li>
</ul></li>
<li><a href="#the-ggplot2-package">The <code>ggplot2</code> package</a></li>
<li><a href="#geometries">Geometries</a><ul>
<li><a href="#geom_line"><code>geom_line</code></a></li>
<li><a href="#geom_point"><code>geom_point</code></a></li>
<li><a href="#geom_boxplot"><code>geom_boxplot</code></a></li>
<li><a href="#geom_violin"><code>geom_violin</code></a></li>
<li><a href="#geom_histogram"><code>geom_histogram</code></a></li>
<li><a href="#geom_bar"><code>geom_bar</code></a></li>
<li><a href="#dot-plot">dot plot</a></li>
<li><a href="#combining-geometries">Combining geometries</a></li>
</ul></li>
<li><a href="#tweaking-a-ggplot2-graph">Tweaking a ggplot2 graph</a><ul>
<li><a href="#title">Title</a></li>
<li><a href="#axes-labels">Axes labels</a></li>
<li><a href="#axes-limits">Axes limits</a></li>
<li><a href="#aspect-ratio">Aspect ratio</a></li>
<li><a href="#colors">Colors</a><ul>
<li><a href="#continuous-color-schemes">Continuous color schemes</a></li>
<li><a href="#categorical-color-schemes">Categorical color schemes</a></li>
</ul></li>
</ul></li>
<li><a href="#faceting">Faceting</a><ul>
<li><a href="#faceting-by-categorical-variable">Faceting by categorical variable</a></li>
<li><a href="#faceting-by-continuous-variable">Faceting by continuous variable</a></li>
</ul></li>
</ul>
</div>

<div style="color:#ff7535; background-color:#fff0ee ;   border-left-style: solid">
<p>This tutorial makes use of the following R package(s): <strong><code>dplyr</code></strong>, <strong><code>tidyr</code></strong>, <strong><code>ggplot2</code></strong>, <strong><code>stringr</code></strong></p>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<p>Data used in this tutorial include grain harvest for north america and income/education census data for the US.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://mgimond.github.io/ES218/Data/FAO_grains_NA.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)
dat2 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://mgimond.github.io/ES218/Data/Income_education.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</code></pre></div>
<div id="dataset-dat1" class="section level2">
<h2>Dataset <code>dat1</code></h2>
<p><code>dat1</code> consists of grain yields by north american countries and by year. The dataset was downloaded from <a href="http://faostat3.fao.org/" class="uri">http://faostat3.fao.org/</a> in June of 2014.</p>
<p>A subset of <code>dat1</code> will be used in this tutorial in both a <em>wide</em> form and a <em>long</em> form. The wide form will be called <code>dat1w</code> and will be a table of year vs. crop yields.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(tidyr)

dat1w &lt;-<span class="st"> </span>dat1 %&gt;%
<span class="st">         </span><span class="kw">filter</span>(Information ==<span class="st"> &quot;Yield (Hg/Ha)&quot;</span>, 
                Country     ==<span class="st">&quot;United States of America&quot;</span>, 
                Crop       %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Oats&quot;</span>, <span class="st">&quot;Maize&quot;</span>, <span class="st">&quot;Barley&quot;</span>, <span class="st">&quot;Buckwheat&quot;</span>,<span class="st">&quot;Rye&quot;</span>)) %&gt;%
<span class="st">         </span><span class="kw">select</span>(Year, Crop, Value)                                          %&gt;%
<span class="st">         </span><span class="kw">spread</span>(<span class="dt">key =</span> Crop, <span class="dt">value=</span><span class="st">&quot;Value&quot;</span>)
<span class="kw">head</span>(dat1w)</code></pre></div>
<pre><code>  Year   Barley Buckwheat    Maize     Oats      Rye
1 1961 16488.52  10886.67 39183.63 15171.26 11121.79
2 1962 18839.00  11737.50 40620.80 16224.60 12892.77
3 1963 18808.27  11995.00 42595.55 16253.04 11524.11
4 1964 20208.88  11566.50 39498.36 15471.55 12026.24
5 1965 23070.58  11875.00 46492.14 18001.04 14192.91
6 1966 20581.66  11956.52 45891.88 16117.92 13670.75</code></pre>
<p>The <em>long</em> form version of the subset will be called <code>dat1l</code> and will be a <em>long</em> form representation of <code>dat1w</code> (yield by crop and year).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1l &lt;-<span class="st"> </span><span class="kw">gather</span>(dat1w, <span class="dt">key =</span> <span class="st">&quot;Crop&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;Yield&quot;</span>, <span class="dv">2</span>:<span class="dv">6</span>)
<span class="kw">head</span>(dat1l,<span class="dv">10</span>)</code></pre></div>
<pre><code>   Year   Crop    Yield
1  1961 Barley 16488.52
2  1962 Barley 18839.00
3  1963 Barley 18808.27
4  1964 Barley 20208.88
5  1965 Barley 23070.58
6  1966 Barley 20581.66
7  1967 Barley 21785.30
8  1968 Barley 23557.07
9  1969 Barley 24039.46
10 1970 Barley 23048.77</code></pre>
<p>Another subset will be used in this exercise and will consist of total yields for each year by crop and country.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1l2 &lt;-<span class="st"> </span>dat1 %&gt;%
<span class="st">          </span><span class="kw">filter</span>(Information ==<span class="st"> &quot;Yield (Hg/Ha)&quot;</span>, 
                 Crop       %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Oats&quot;</span>, <span class="st">&quot;Maize&quot;</span>, <span class="st">&quot;Barley&quot;</span>, <span class="st">&quot;Buckwheat&quot;</span>,<span class="st">&quot;Rye&quot;</span>)) %&gt;%
<span class="st">          </span><span class="kw">select</span>( Year, Crop, Country,  <span class="dt">Yield =</span> Value)  <span class="co"># Note that we are renaming the Value field</span>

<span class="kw">head</span>(dat1l2,<span class="dv">15</span>)</code></pre></div>
<pre><code>   Year      Crop                  Country    Yield
1  2012    Barley                   Canada 38894.66
2  2012     Maize                   Canada 83611.49
3  2012      Oats                   Canada 24954.79
4  2012       Rye                   Canada 38056.86
5  2012    Barley United States of America 36533.24
6  2012 Buckwheat United States of America 10445.86
7  2012     Maize United States of America 77441.67
8  2012      Oats United States of America 21974.70
9  2012       Rye United States of America 17575.73
10 2011    Barley                   Canada 32796.43
11 2011     Maize                   Canada 88946.49
12 2011      Oats                   Canada 29109.36
13 2011       Rye                   Canada 24676.81
14 2011    Barley United States of America 37431.96
15 2011 Buckwheat United States of America 10299.05</code></pre>
</div>
<div id="dataset-dat2" class="section level2">
<h2>Dataset <code>dat2</code></h2>
<p><code>dat2</code> consists of county income and educational attainment for both the male and female population. A codebook <a href="http://mgimond.github.io/ES218/Data/Income_education_codebook.csv">available here</a> provides descriptions for the different codes. We will remove the cases (rows) from <code>dat2</code> for which values are missing (i.e. cases having a <code>NA</code> designation) since these rows will serve no purpose (such cases may be associated with counties having no year-round residents or a resident population too small for data dissemination).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2 &lt;-<span class="st"> </span><span class="kw">na.omit</span>(dat2)</code></pre></div>
<p>As with <code>dat1</code>, we will create a tidy version of <code>dat2</code> for use with <code>ggplot</code> plotting routines.</p>
<p>The <code>dat2</code> dataset has income data broken down by educational attainment and gender aggregated at the county level. It would therefore be convenient for subsequent plot operations if two variables, <code>Gender</code> and (educational) <code>Level</code>, were added to the long table version of <code>dat2</code>.</p>
<div class="figure">
<img src="img/Census_table_1.png" alt="Census Table" />
<p class="caption">Census Table</p>
</div>
<p>We will first generate a lookup table, <code>Edu.Gend</code>, of variable elements that will match each census category (e.g. <code>B20004001</code>, <code>B20004002</code>, …) to its matching pair of <code>Level</code> and <code>Gender</code> types.</p>
<p>We will also create a State/Region lookup table, <code>st.reg</code>, that will store two variables: the two letter state abbreviation variable <code>State</code> and it matching region variable <code>Region</code>. R has a built-in vector called <code>state.region</code> that assigns a region to each state. However, you’ll note that this vector only has region names but makes no reference to states. It’s intended to be used with another built-in data vector called <code>state.abb</code> or <code>state.name</code>. We will combine <code>state.abb</code> with <code>state.region</code> to create <code>st.reg</code>. We will also need to convert the uppercase state abbreviations to lower case using <code>tolower</code> so that they match the <code>dat2</code>’s lowercase state abbreviations. Note that D.C. is not included in the built-in states dataset, so we will add this record the <code>st.reg</code> table and assign D.C. to the <code>South</code> region.</p>
<p>Finally, the two tables, <code>Edu.gend</code> and <code>st.reg</code>, will be joined to the long version of <code>dat2</code> such that each observation will be assigned a <code>Level</code>, <code>Gender</code> and <code>Region</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
<span class="co"># Create a variable/Level/Gender join table</span>
Edu.Gend &lt;-<span class="st"> </span><span class="kw">data.frame</span>( 
               <span class="dt">variable   =</span> <span class="kw">paste</span>(<span class="st">&quot;B200040&quot;</span>, <span class="kw">str_pad</span>(<span class="dv">1</span>:<span class="dv">18</span>, <span class="dt">width=</span><span class="dv">2</span> , <span class="dt">pad=</span><span class="st">&quot;0&quot;</span>),<span class="dt">sep=</span><span class="st">&quot;&quot;</span> ),
               <span class="dt">Level      =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;All&quot;</span>, <span class="st">&quot;NoHS&quot;</span>,<span class="st">&quot;HS&quot;</span>,<span class="st">&quot;AD&quot;</span>,<span class="st">&quot;BD&quot;</span>,<span class="st">&quot;Grad&quot;</span>), <span class="dt">times=</span><span class="dv">3</span>),
               <span class="dt">Gender     =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">&quot;All&quot;</span>, <span class="st">&quot;M&quot;</span>,<span class="st">&quot;F&quot;</span>), <span class="dt">each=</span><span class="dv">6</span>) )

<span class="co"># Create a region/state join table</span>
st.reg &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">State =</span> <span class="kw">tolower</span>(state.abb), <span class="dt">Region =</span> state.region)
st.reg &lt;-<span class="st"> </span><span class="kw">rbind</span>(st.reg , <span class="kw">data.frame</span>(<span class="dt">State=</span><span class="st">&quot;dc&quot;</span>, <span class="dt">Region=</span><span class="st">&quot;South&quot;</span>) )

<span class="co"># Start the piping operations</span>
dat2b &lt;-<span class="st"> </span>dat2 %&gt;%
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>, -<span class="dv">1</span>:-<span class="dv">2</span>)  %&gt;%
<span class="st">  </span><span class="kw">inner_join</span>(Edu.Gend, <span class="dt">by=</span><span class="st">&quot;variable&quot;</span> )              %&gt;%
<span class="st">  </span><span class="kw">select</span>(State, County, Level, Gender, value)       %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Level =</span> <span class="kw">factor</span>(Level, 
                        <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;All&quot;</span>,<span class="st">&quot;NoHS&quot;</span>,<span class="st">&quot;HS&quot;</span>, <span class="st">&quot;AD&quot;</span>, <span class="st">&quot;BD&quot;</span>, <span class="st">&quot;Grad&quot;</span>))) %&gt;%
<span class="st">  </span><span class="kw">inner_join</span>(st.reg , <span class="dt">by=</span><span class="st">&quot;State&quot;</span>)
<span class="kw">head</span>(dat2b)</code></pre></div>
<pre><code>  State  County Level Gender value Region
1    al Autauga   All    All 35881  South
2    al Baldwin   All    All 31439  South
3    al Barbour   All    All 25201  South
4    al    Bibb   All    All 29016  South
5    al  Blount   All    All 32035  South
6    al Bullock   All    All 26408  South</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(dat2b)</code></pre></div>
<pre><code>      State     County Level Gender value Region
55201    wy   Sublette  Grad      F 59683   West
55202    wy Sweetwater  Grad      F 63681   West
55203    wy      Teton  Grad      F 48357   West
55204    wy      Uinta  Grad      F 52321   West
55205    wy   Washakie  Grad      F 50341   West
55206    wy     Weston  Grad      F 56765   West</code></pre>
<p>Note that we have eliminated references to variable names such as “B20004001” from <code>dat2b</code> making it easier to interpret the variable names/values.</p>
<p>In <code>dat2b</code> the gender values are lumped under the variable called <code>Gender</code>. We may wish to have male and female incomes assigned their own columns so we will need to <em>widen</em> <code>dat2b</code> so that each gender value is given its own column. We will use the <code>spread</code> function from the <code>tidyr</code> package to create a new data frame called <code>dat2.gender</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2c &lt;-<span class="st"> </span><span class="kw">spread</span>(dat2b, <span class="dt">key =</span> Gender, <span class="dt">value =</span> value )</code></pre></div>
</div>
</div>
<div id="the-ggplot2-package" class="section level1">
<h1>The <code>ggplot2</code> package</h1>
<p>The <code>ggplot2</code> package is designed around the idea that scientific graphics can be decomposed into a formal system of rules–grammatical rules. The <code>ggplot2</code> learning curve is the steepest of all graphing environments encountered thus far, but once mastered it affords the greatest control over graphical design. For an up-to-date list of <code>ggplot2</code> functions, you may want to refer to ggplot2’s <a href="http://docs.ggplot2.org/current/">website</a>.</p>
<p>A plot in <code>ggplot2</code> consists of different <em>layering</em> components, with the three primary components being:</p>
<ul>
<li>The <strong>dataset</strong> that houses the data to be plotted.</li>
<li>The <strong>aesthetics</strong> which describe how data are to be mapped to the geometric elements</li>
<li>The <strong>geometric</strong> elements to use in the plot (i.e. points, lines, rectangles, etc…)</li>
</ul>
<p>Additional (optional) layering components include:</p>
<ul>
<li><strong>Statistical</strong> elements such as smoothing, binning or transforming the variable</li>
<li><strong>Facets</strong> for conditional or trellis plots</li>
<li><strong>Coordinate systems</strong> for defining the plots shape (i.e. cartesian, polar, spatial map projections, etc…)</li>
</ul>
<p>To access <code>ggplot2</code> functions, you will need to load its library:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)</code></pre></div>
<p>From a grammatical perspective, a scientific graph is the conversion of <em>data</em> to <strong>aesthetic</strong> attributes and <strong>geometric</strong> objects. This is an important concept to grasp since it underlies the construction of all graphics in <code>ggplot2</code>.</p>
<p>For example, if we want to generate a point plot of crop yield as a function of year using the <code>dat1l</code> data frame, we type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l , <span class="kw">aes</span>(<span class="dt">x=</span>Year, <span class="dt">y=</span>Yield)) +<span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-10-1.png" width="480" /></p>
<p>where the function, <code>ggplot()</code>, is passed the data frame name whose content will be mapped; the <code>aes()</code> function is given data-to-geometry mapping instructions (<code>Year</code> is mapped to the x-axis and <code>Yield</code> is mapped to the y-axis); and <code>geom_line()</code> is the geometry type.</p>
<div class="figure">
<img src="img/ggplot_1.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>If we wanted to include a third variable, crop type, to the map, we would need to map its aesthetics: here we’ll map <code>Crop</code> to the color element of the geom.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l , <span class="kw">aes</span>(<span class="dt">x=</span>Year, <span class="dt">y=</span>Yield, <span class="dt">color=</span>Crop)) +<span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-11-1.png" width="480" /></p>
<p>The parameter <code>color</code> acts as a grouping parameter whereby the groups are assigned unique colors.</p>
<div class="figure">
<img src="img/ggplot_2.png" alt="alt text" />
<p class="caption">alt text</p>
</div>
<p>If we want to plot lines instead of points, simply substitute the geometry type with the <code>geom_line()</code> geometry.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l , <span class="kw">aes</span>(<span class="dt">x=</span>Year, <span class="dt">y=</span>Yield, <span class="dt">color=</span>Crop)) +<span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-12-1.png" width="480" /></p>
<p>Note that the aesthetics are still mapped in the same way with <code>Year</code> mapped to the x coordinate, <code>Yield</code> mapped to the y coordinate and <code>Crop</code> mapped to the geom’s color.</p>
<p>Note that the parameters <code>x=</code> and <code>y=</code> can be omitted from the syntax reducing the line of code to:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l , <span class="kw">aes</span>(Year, Yield, <span class="dt">color=</span>Crop)) +<span class="st"> </span><span class="kw">geom_line</span>()</code></pre></div>
</div>
<div id="geometries" class="section level1">
<h1>Geometries</h1>
<p>Examples of a few available geometric elements follow.</p>
<div id="geom_line" class="section level2">
<h2><code>geom_line</code></h2>
<p><code>geom_line</code> generates line geometries. We’ll use data from <code>dat1w</code> to generate a simple plot of oat yield as a function of year.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1w, <span class="kw">aes</span>(<span class="dt">x=</span>Year, <span class="dt">y=</span>Oats)) +<span class="st"> </span><span class="kw">geom_line</span>() </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-14-1.png" width="480" /></p>
<p>Parameters such as color and linetype can be passed directly to the <code>geom_line()</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1w, <span class="kw">aes</span>(<span class="dt">x=</span>Year, <span class="dt">y=</span>Oats)) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">linetype=</span><span class="dv">2</span>, <span class="dt">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">size=</span><span class="fl">0.4</span>) </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-15-1.png" width="480" /></p>
<p>Note the difference in how <code>colour=</code> is implemented here. It’s no longer <strong>mapping</strong> a variable’s levels to a range of colors as when it’s called inside of the <code>aes()</code> function, instead, it’s <strong>setting</strong> the line color to <code>blue</code>.</p>
</div>
<div id="geom_point" class="section level2">
<h2><code>geom_point</code></h2>
<p>This generates point geometries. This is often used in generating scatterplots. For example, to plot male income (variable <code>B20004013</code>) vs female income (variable <code>B20004007</code>), type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(<span class="dt">x=</span>B20004013, <span class="dt">y=</span>B20004007)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>) </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-16-1.png" width="384" /></p>
<p>We modify the point’s transparency by passing the <code>alpha=0.3</code> parameter to the <code>geom_point</code> function. Other parameters that can be passed to point geoms include <code>colour</code>, <code>pch</code> (point symbol type) and <code>cex</code> (point size as a fraction).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(<span class="dt">x=</span>B20004013, <span class="dt">y=</span>B20004007)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">colour=</span><span class="st">&quot;red&quot;</span>, <span class="dt">pch=</span><span class="dv">3</span> , <span class="dt">alpha=</span><span class="fl">0.3</span>, <span class="dt">cex=</span><span class="fl">0.6</span>) </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-17-1.png" width="384" /></p>
</div>
<div id="geom_boxplot" class="section level2">
<h2><code>geom_boxplot</code></h2>
<p>In the following example, a boxplot of <code>Yield</code> is generated for each crop type.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l, <span class="kw">aes</span>(<span class="dt">x=</span>Crop, <span class="dt">y=</span>Yield)) +<span class="st"> </span><span class="kw">geom_boxplot</span>(<span class="dt">fill=</span><span class="st">&quot;bisque&quot;</span>) </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-18-1.png" width="384" /></p>
<p>If we want to generate a single boxplot (for example for all yields irrespective of crop type) we need to pass a <em>dummy</em> variable to <code>x=</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l, <span class="kw">aes</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span>Yield)) +<span class="st"> </span><span class="kw">geom_boxplot</span>(<span class="dt">fill=</span><span class="st">&quot;bisque&quot;</span>) +<span class="st"> </span><span class="kw">xlab</span>(<span class="st">&quot;All crops&quot;</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-19-1.png" width="384" /></p>
</div>
<div id="geom_violin" class="section level2">
<h2><code>geom_violin</code></h2>
<p>A violin plot is a symmetrical version of a density plot which provides greater detail of a sample’s distribution than a boxplot.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l, <span class="kw">aes</span>(<span class="dt">x=</span><span class="st">&quot;&quot;</span>, <span class="dt">y=</span>Yield)) +<span class="st"> </span><span class="kw">geom_violin</span>(<span class="dt">fill=</span><span class="st">&quot;bisque&quot;</span>) </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-20-1.png" width="384" /></p>
</div>
<div id="geom_histogram" class="section level2">
<h2><code>geom_histogram</code></h2>
<p>Histograms can be plotted for single variables only (unless faceting is used) as can be noted by the absence of a <code>y=</code> parameter in <code>aes()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1w, <span class="kw">aes</span>(<span class="dt">x=</span>Oats)) +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">fill=</span><span class="st">&quot;grey50&quot;</span>) </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-21-1.png" width="384" /></p>
<p>The bin widths can be specified in terms of the value’s units. In our example, the unit is yield of oats (in Hg/Ha). So if we want to generate bin widths that cover 1000 Hg/Ha, we can type,</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1w, <span class="kw">aes</span>(<span class="dt">x=</span>Oats)) +<span class="st"> </span><span class="kw">geom_histogram</span>(<span class="dt">fill=</span><span class="st">&quot;grey50&quot;</span>, <span class="dt">binwidth =</span> <span class="dv">1000</span>) </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-22-1.png" width="384" /></p>
</div>
<div id="geom_bar" class="section level2">
<h2><code>geom_bar</code></h2>
<p>Bar plots are uses to summaries the counts of a categorical value. For example, to plot the number of counties in each state (note that each record in <code>dat2</code> is assigned a county):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(State)) +<span class="st"> </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-23-1.png" width="768" /></p>
<p>To arrange the bars in ascending order we need to rearrange the <code>State</code> factor level order based on total count. We won’t be able to use the <code>reorder</code> function since we do not have a value field to summarize. Instead, we’ll make use of the <code>table</code> function to enumerate each instance of a record associated with each state, sort that vector, then extract the <code>sorted</code> state names. We’ll then create a copy of the <code>State</code> factor object to reflect the new level order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">new.lev.ord     &lt;-<span class="st"> </span><span class="kw">names</span>( <span class="kw">sort</span>(<span class="kw">table</span>(dat2$State)) )
dat2$State.ord  &lt;-<span class="st"> </span><span class="kw">factor</span>(dat2$State, <span class="dt">levels =</span> new.lev.ord)</code></pre></div>
<p>Now let’s recreate the bar plot with the new factor level order.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(State.ord)) +<span class="st"> </span><span class="kw">geom_bar</span>()</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-25-1.png" width="768" /></p>
</div>
<div id="dot-plot" class="section level2">
<h2>dot plot</h2>
<p>The dot plot is an alternative way to visualize counts as a function of a categorical variable. We’ll make use of the <code>geom_point</code> function but we will need to summarize the counts across each state first; unlike <code>geom_bar</code> which will summarize the counts across each factor level,<code>geom_point</code> must be passed a single value for each state.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2.ct &lt;-<span class="st"> </span>dat2 %&gt;%<span class="st"> </span><span class="kw">group_by</span>(State) %&gt;%<span class="st"> </span>
<span class="st">                </span><span class="kw">summarize</span>(<span class="dt">Counties =</span> <span class="kw">n</span>())
<span class="kw">head</span>(dat2.ct)</code></pre></div>
<pre><code># A tibble: 6 × 2
   State Counties
  &lt;fctr&gt;    &lt;int&gt;
1     ak       28
2     al       67
3     ar       74
4     az       15
5     ca       57
6     co       62</code></pre>
<p>Instead of mapping <code>State</code> to the x-axis, we’ll map it to the y-axis.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2.ct , <span class="kw">aes</span>(<span class="dt">x=</span>Counties, <span class="dt">y=</span>State)) +<span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-27-1.png" width="384" /></p>
<p>Dot plot graphics benefit from sorting–more so then bar plots. But instead of computing a new level order outside of the plotting function, we will make use of the <code>reorder</code> function <em>inside</em> of the <code>aes</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2.ct , <span class="kw">aes</span>(<span class="dt">x=</span>Counties, <span class="dt">y=</span><span class="kw">reorder</span>(State, Counties))) +<span class="st"> </span><span class="kw">geom_point</span>()</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-28-1.png" width="384" /></p>
</div>
<div id="combining-geometries" class="section level2">
<h2>Combining geometries</h2>
<p>Geometries can be layered. For example, to overlay a linear regression line to the data we can add the <code>geom_smooth</code> layer:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(<span class="dt">x=</span>B20004013, <span class="dt">y=</span>B20004007)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>) +<span class="st"> </span>
<span class="st">                                              </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-29-1.png" width="384" /></p>
<p>The <code>geom_smooth</code> can be used to fit other <em>lines</em> such as a loess:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(<span class="dt">x=</span>B20004013, <span class="dt">y=</span>B20004007)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>) +
<span class="st">                                              </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-30-1.png" width="384" /></p>
<p>The confidence interval can be removed from the smooth geometry by specifying <code>se=FALSE</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(<span class="dt">x=</span>B20004013, <span class="dt">y=</span>B20004007)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>) +
<span class="st">                                              </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;loess&quot;</span>, <span class="dt">se=</span><span class="ot">FALSE</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-31-1.png" width="384" /></p>
</div>
</div>
<div id="tweaking-a-ggplot2-graph" class="section level1">
<h1>Tweaking a ggplot2 graph</h1>
<div id="title" class="section level2">
<h2>Title</h2>
<p>You can add a plot title using the <code>ggtile</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(State)) +<span class="st"> </span><span class="kw">geom_bar</span>() +<span class="kw">ggtitle</span>(<span class="st">&quot;Number of counties by state&quot;</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-32-1.png" width="768" /></p>
</div>
<div id="axes-labels" class="section level2">
<h2>Axes labels</h2>
<p>Axes labels can be explicitly defined using the <code>xlab()</code> and <code>ylab()</code> functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(<span class="dt">x=</span>B20004013, <span class="dt">y=</span>B20004007)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>) +
<span class="st">               </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) +
<span class="st">               </span><span class="kw">xlab</span>(<span class="st">&quot;Female income ($)&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Male income ($)&quot;</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-33-1.png" width="384" /></p>
<p>To remove axis labels, simply pass <code>NULL</code> to the functions as in <code>xlab(NULL)</code> and <code>ylab(NULL)</code>.</p>
</div>
<div id="axes-limits" class="section level2">
<h2>Axes limits</h2>
<p>The axis range can be set using <code>xlim()</code> and <code>ylim()</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(<span class="dt">x=</span>B20004013, <span class="dt">y=</span>B20004007)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>) +
<span class="st">               </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) +
<span class="st">               </span><span class="kw">xlab</span>(<span class="st">&quot;Female income ($)&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Male income ($)&quot;</span>) +
<span class="st">               </span><span class="kw">xlim</span>( <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">75000</span>)) +<span class="st"> </span><span class="kw">ylim</span>( <span class="kw">c</span>(<span class="dv">10000</span>, <span class="dv">75000</span>)) </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-34-1.png" width="384" /></p>
</div>
<div id="aspect-ratio" class="section level2">
<h2>Aspect ratio</h2>
<p>You can impose an aspect ratio to your plot using the <code>coord_equal()</code> function. For example, to set the axes units equal (in length) to one another set <code>ratio=1</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2, <span class="kw">aes</span>(<span class="dt">x=</span>B20004013, <span class="dt">y=</span>B20004007)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.3</span>) +
<span class="st">               </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>) +
<span class="st">               </span><span class="kw">xlab</span>(<span class="st">&quot;Female income ($)&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Male income ($)&quot;</span>) +
<span class="st">               </span><span class="kw">coord_equal</span>(<span class="dt">ratio=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-35-1.png" width="384" /></p>
</div>
<div id="colors" class="section level2">
<h2>Colors</h2>
<p>You can customize geom colors using one of two sets of color schemes: one for continuous values, the other for categorical (discrete) values.</p>
<table style="width:69%;">
<colgroup>
<col width="34%" />
<col width="34%" />
</colgroup>
<thead>
<tr class="header">
<th>Continuous</th>
<th>Categorical</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p><code>scale_colour_gradient</code> <code>scale_colour_gradient2</code> <code>scale_color_distiller</code> <code>scale_fill_gradient2</code> <code>scale_fill_gradient</code> <code>scale_fill_distiller</code></p></td>
<td><p><code>scale_colour_hue</code> <code>scale_colour_grey</code> <code>scale_colour_manual</code> <code>scale_colour_brewer</code></p></td>
</tr>
</tbody>
</table>
<p>A few examples follow.</p>
<div id="continuous-color-schemes" class="section level3">
<h3>Continuous color schemes</h3>
<p>The following chunk applies a green to red color gradient fill to each bar. Note that we are using the summarized count table (and not the original <code>dat2</code> table). When plotting bars from counts already tabulated specify <code>stat=&quot;identity&quot;</code> in the <code>geom_bar</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2.ct, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(State, Counties), <span class="dt">y=</span>Counties, <span class="dt">fill=</span>Counties)) +<span class="st"> </span>
<span class="st">                </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) +<span class="st"> </span>
<span class="st">                </span><span class="kw">scale_fill_gradient</span>(<span class="dt">low =</span> <span class="st">&quot;green&quot;</span>, <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-36-1.png" width="768" /></p>
<p>The following chunk applies a divergent color scheme while allowing one to specify the central value of this scheme. Note that the colors are symmetrical about the midpoint which may result in only a partial range of the full possible gradient of colors.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2.ct, <span class="kw">aes</span>(<span class="dt">x=</span><span class="kw">reorder</span>(State, Counties), <span class="dt">y=</span>Counties, <span class="dt">fill=</span>Counties)) +<span class="st"> </span>
<span class="st">                </span><span class="kw">geom_bar</span>(<span class="dt">stat=</span><span class="st">&quot;identity&quot;</span>) +<span class="st"> </span>
<span class="st">                </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;blue&quot;</span>, <span class="dt">mid =</span> <span class="st">&quot;white&quot;</span>,  <span class="dt">high =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">midpoint =</span> <span class="dv">61</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-37-1.png" width="768" /></p>
<p>In the last two chunk, we <em>filled</em> the bars with colors (note the use of functions with the string <code>_fill_</code>). When assigning color to point or line symbols, use the function with the <code>_colour_</code> string. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2.ct , <span class="kw">aes</span>(<span class="dt">x=</span>Counties, <span class="dt">y=</span><span class="kw">reorder</span>(State, Counties), <span class="dt">col=</span>Counties)) +
<span class="st">                 </span><span class="kw">geom_point</span>() +
<span class="st">                 </span><span class="kw">scale_colour_gradient2</span>(<span class="dt">low =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="dt">mid =</span> <span class="st">&quot;white&quot;</span>,  <span class="dt">high =</span> <span class="st">&quot;darkred&quot;</span>, <span class="dt">midpoint =</span> <span class="dv">61</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-38-1.png" width="384" /></p>
</div>
<div id="categorical-color-schemes" class="section level3">
<h3>Categorical color schemes</h3>
<p>In the following chunk, we assign colors manually to each level in the variable <code>Yield</code>. The order of the color names mirror the order of the variable levels.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l, <span class="kw">aes</span>(Year, Yield, <span class="dt">col=</span>Crop)) +<span class="st"> </span>
<span class="st">              </span><span class="kw">geom_line</span>() +
<span class="st">              </span><span class="kw">scale_colour_manual</span>(<span class="dt">values =</span> <span class="kw">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;orange&quot;</span>, <span class="st">&quot;green&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;yellow&quot;</span>))</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-39-1.png" width="672" /></p>
<p>The following chunk applies a predefined discrete color scheme named <code>Dark2</code> to each level.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l, <span class="kw">aes</span>(Year, Yield, <span class="dt">col=</span>Crop)) +<span class="st"> </span>
<span class="st">              </span><span class="kw">geom_line</span>() +
<span class="st">              </span><span class="kw">scale_colour_brewer</span>(<span class="dt">palette =</span> <span class="st">&quot;Dark2&quot;</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-40-1.png" width="672" /></p>
<p>To see a list of predefined <code>scale_colour_brewer</code> colors, type <code>?scale_colour_brewer</code> at the console.</p>
</div>
</div>
</div>
<div id="faceting" class="section level1">
<h1>Faceting</h1>
<div id="faceting-by-categorical-variable" class="section level2">
<h2>Faceting by categorical variable</h2>
<p>Faceting (or conditioning on a variable) can be implemented in <code>ggplot2</code> using the <code>facet_wrap()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l2, <span class="kw">aes</span>(<span class="dt">x=</span>Year, <span class="dt">y=</span>Yield, <span class="dt">color=</span>Crop)) +<span class="st"> </span><span class="kw">geom_line</span>() +<span class="st"> </span>
<span class="st">                                    </span><span class="kw">facet_wrap</span>( ~<span class="st"> </span>Country, <span class="dt">nrow=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-41-1.png" width="576" /></p>
<p>The parameter <code>~ Country</code> tells ggplot to condition the plots on country. If we wanted the plots to be stacked, we would set <code>nrow</code> to <code>2</code>.</p>
<p>We can also condition the plots on two variables such as <code>crop</code> and <code>Country</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l2, <span class="kw">aes</span>(<span class="dt">x=</span>Year, <span class="dt">y=</span>Yield)) +<span class="st"> </span><span class="kw">geom_line</span>() +
<span class="st">                                    </span><span class="kw">facet_wrap</span>(Crop ~<span class="st"> </span>Country, <span class="dt">nrow=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-42-1.png" width="768" /></p>
<p>This creates as many plots as there are unique combinations of variables <code>Crop</code> and <code>Country</code>. But such plots are usually best represented in a grid structure where one variable is spread along one axis and the other variable is spread along another axis of the plot layout. This can be accomplished using the <code>facet_grid</code> function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat1l2, <span class="kw">aes</span>(<span class="dt">x=</span>Year, <span class="dt">y=</span>Yield)) +<span class="st"> </span><span class="kw">geom_line</span>() +<span class="st"> </span>
<span class="st">                                       </span><span class="kw">facet_grid</span>( Crop ~<span class="st"> </span>Country)</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-43-1.png" width="576" /></p>
</div>
<div id="faceting-by-continuous-variable" class="section level2">
<h2>Faceting by continuous variable</h2>
<p>In the above example, we are faceting the plots based on a categorical variable: <code>Country</code> and/or <code>crop</code>. But what if we want to facet the plots based on a continuous variable? For example, we might be interested in comparing male and female incomes across different female income ranges. This requires that a new categorical field (a factor) be created assigning to each case (row) an income group. We can use the <code>cut()</code> function to accomplish this task (we’ll also omit all values greater than 100,000):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2c$incrng &lt;-<span class="st"> </span><span class="kw">cut</span>(dat2c$F , <span class="dt">breaks =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">25000</span>, <span class="dv">50000</span>, <span class="dv">75000</span>, <span class="dv">100000</span>) )
<span class="kw">head</span>(dat2c)</code></pre></div>
<pre><code>  State                 County Level Region   All     F     M          incrng
1    ak Aleutians East Borough   All   West 21953 20164 22940     (0,2.5e+04]
2    ak Aleutians East Borough  NoHS   West 21953 19250 22885     (0,2.5e+04]
3    ak Aleutians East Borough    HS   West 20770 19671 21192     (0,2.5e+04]
4    ak Aleutians East Borough    AD   West 26383 26750 26352 (2.5e+04,5e+04]
5    ak Aleutians East Borough    BD   West 22431 19592 27875     (0,2.5e+04]
6    ak Aleutians East Borough  Grad   West 74000 74000 71250 (5e+04,7.5e+04]</code></pre>
<p>In this chunk of code, we create a new variable, <code>incrng</code>, which is assigned an income category group depending on which range <code>dat2c$F</code> (female income) falls into. The income interval breaks are defined in <code>breaks=</code>. In the output, you will note that the factor <code>incrng</code> defines a range of incomes (e.g. <code>(0 , 2.5e+04]</code>) where the parenthesis <code>(</code> indicates that the left-most value is exclusive and the bracket <code>]</code> indicates that the right-most value is inclusive.</p>
<p>However, because we did not create categories that covered all income values in <code>dat2c$F</code> we ended up with a few <code>NA</code>’s in the <code>incrng</code> column:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(dat2c$incrng)</code></pre></div>
<pre><code>    (0,2.5e+04] (2.5e+04,5e+04] (5e+04,7.5e+04] (7.5e+04,1e+05]            NA&#39;s 
           9419            7520            1425              33               5 </code></pre>
<p>We will remove all rows associated with missing <code>incrng</code> values:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2c &lt;-<span class="st"> </span><span class="kw">na.omit</span>(dat2c)
<span class="kw">summary</span>(dat2c$incrng)</code></pre></div>
<pre><code>    (0,2.5e+04] (2.5e+04,5e+04] (5e+04,7.5e+04] (7.5e+04,1e+05] 
           9419            7520            1425              33 </code></pre>
<p>We can list all unique levels in our newly created factor using the <code>levels()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(dat2c$incrng) </code></pre></div>
<pre><code>[1] &quot;(0,2.5e+04]&quot;     &quot;(2.5e+04,5e+04]&quot; &quot;(5e+04,7.5e+04]&quot; &quot;(7.5e+04,1e+05]&quot;</code></pre>
<p>The intervals are not meaningful displayed as is (particularly when scientific notation is adopted). So we will assign more meaningful names to our factor levels as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(dat2c$incrng) &lt;-<span class="st">  </span><span class="kw">c</span>(<span class="st">&quot;Under 25k&quot;</span>, <span class="st">&quot;25k-50k&quot;</span>, <span class="st">&quot;50k-75k&quot;</span>, <span class="st">&quot;75k-100k&quot;</span>)
<span class="kw">head</span>(dat2c)</code></pre></div>
<pre><code>  State                 County Level Region   All     F     M    incrng
1    ak Aleutians East Borough   All   West 21953 20164 22940 Under 25k
2    ak Aleutians East Borough  NoHS   West 21953 19250 22885 Under 25k
3    ak Aleutians East Borough    HS   West 20770 19671 21192 Under 25k
4    ak Aleutians East Borough    AD   West 26383 26750 26352   25k-50k
5    ak Aleutians East Borough    BD   West 22431 19592 27875 Under 25k
6    ak Aleutians East Borough  Grad   West 74000 74000 71250   50k-75k</code></pre>
<p>Note that the order in which the names are passed must match that of the original breaks.</p>
<p>Now we can facet male vs. female scatter plots by income ranges. We will also throw in a best fit line to the plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2c, <span class="kw">aes</span>(<span class="dt">x=</span>F, <span class="dt">y=</span>M)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.2</span>, <span class="dt">pch=</span><span class="dv">20</span>) +
<span class="st">                               </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) +
<span class="st">                               </span><span class="kw">facet_grid</span>( . ~<span class="st"> </span>incrng) </code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-49-1.png" width="768" /></p>
<p>One reason we would want to explore our data across different ranges of value is to assess the consistency in relationship between variables. In our example, this plot helps assess whether the relationship between male and female income is consistent across income groups.</p>
<p>To highlight differences in income, we will make a few changes to the plots. First, we will reduce the y-axis range to $0-$150k (this will remove a few points from the data); we will force the x-axis and y-axis units to match so that a unit of $50k on the x-axis has the same length as that on the y-axis; and we will add a 45° line (<code>geom_abline(c(0,1))</code> where 0 is the intercept and 1 is the slope) to help visualize the discrepancy (if a point lies above the 45° line, then male’s income is greater, if the point lies below, then female’s income is greater); we will also reduce the number of tics and assign shorthand notation to income values (such as “50k” instead of “50000”). All this can be accomplished by adding the <code>scale_x_continuous()</code> function to the stack of ggplot elements.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2c,  <span class="kw">aes</span>(<span class="dt">x=</span>F, <span class="dt">y=</span>M)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.2</span>, <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex=</span><span class="fl">0.8</span>) +<span class="st"> </span>
<span class="st">                                </span><span class="kw">ylim</span>( <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">150000</span>)) +
<span class="st">                                </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) +<span class="st"> </span>
<span class="st">                                </span><span class="kw">facet_grid</span>( . ~<span class="st"> </span>incrng) +<span class="st"> </span>
<span class="st">                                </span><span class="kw">coord_equal</span>(<span class="dt">ratio=</span><span class="dv">1</span>) +<span class="st"> </span>
<span class="st">                                </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="st">&quot;grey50&quot;</span>) +
<span class="st">                                </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">50000</span>,<span class="dv">100000</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;50k&quot;</span>, <span class="st">&quot;100k&quot;</span>))</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-50-1.png" width="768" /></p>
<p>Note the change in regression slope for the last facet. The <code>geom_smooth</code> operation is only applied to the data limited to the axis range defined by <code>ylim</code>.</p>
<p>Now let’s look at the same data but this time conditioned on educational attainment.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plot M vs F by educational attainment except for Level == All</span>
<span class="kw">ggplot</span>(dat2c, <span class="kw">aes</span>(<span class="dt">x=</span>F, <span class="dt">y=</span>M)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.2</span>, <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex=</span><span class="fl">0.8</span>) +
<span class="st">                               </span><span class="kw">ylim</span>( <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">150000</span>)) +<span class="st"> </span>
<span class="st">                               </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) +
<span class="st">                               </span><span class="kw">facet_grid</span>( . ~<span class="st"> </span>Level) +<span class="st">  </span>
<span class="st">                               </span><span class="kw">coord_equal</span>(<span class="dt">ratio=</span><span class="dv">1</span>) +<span class="st"> </span>
<span class="st">                               </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="st">&quot;grey50&quot;</span>) +
<span class="st">                               </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">50000</span>,<span class="dv">100000</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;50k&quot;</span>, <span class="st">&quot;100k&quot;</span>))</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-51-1.png" width="960" /></p>
<p>We can also condition the plots on two variables: educational attainment and region.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(dat2c, <span class="kw">aes</span>(<span class="dt">x=</span>F, <span class="dt">y=</span>M)) +<span class="st"> </span><span class="kw">geom_point</span>(<span class="dt">alpha=</span><span class="fl">0.2</span>, <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex=</span><span class="fl">0.8</span>) +
<span class="st">                               </span><span class="kw">ylim</span>( <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">150000</span>)) +<span class="st"> </span>
<span class="st">                               </span><span class="kw">geom_smooth</span>(<span class="dt">method =</span> <span class="st">&quot;lm&quot;</span>, <span class="dt">col=</span><span class="st">&quot;red&quot;</span>) +<span class="st"> </span>
<span class="st">                               </span><span class="kw">facet_grid</span>( Region ~<span class="st"> </span>Level) +<span class="st">  </span>
<span class="st">                               </span><span class="kw">coord_equal</span>(<span class="dt">ratio=</span><span class="dv">1</span>) +
<span class="st">                               </span><span class="kw">geom_abline</span>(<span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">col=</span><span class="st">&quot;grey50&quot;</span>) +
<span class="st">                               </span><span class="kw">scale_x_continuous</span>(<span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">50000</span>,<span class="dv">100000</span>), <span class="dt">labels=</span><span class="kw">c</span>(<span class="st">&quot;50k&quot;</span>, <span class="st">&quot;100k&quot;</span>))</code></pre></div>
<p><img src="Week04c_files/figure-html/unnamed-chunk-52-1.png" width="960" /></p>
</div>
</div>


<div class="footer">
<hr/>
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>  Manny Gimond (2017)
</br>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
