<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Week4: Lattice plotting environment</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs\style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 02</li>
    <li>
      <a href="Week02a.html">Data types</a>
    </li>
    <li>
      <a href="Week02b.html">Reading and writing data files</a>
    </li>
    <li>
      <a href="Week02c.html">Working with date objects</a>
    </li>
    <li>
      <a href="Week02d.html">Exploring and cleaning dataframes using base functions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 03</li>
    <li>
      <a href="Week03a.html">Manipulating dataframes with dplyr</a>
    </li>
    <li>
      <a href="Week03ab_groupby.html">Grouping and summarizing tables</a>
    </li>
    <li>
      <a href="Week03b.html">Tidying/reshaping tables using tidyr</a>
    </li>
    <li>
      <a href="Week03ab_examples.html">Example of data manipulation workflows</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 04</li>
    <li>
      <a href="Week03c.html">Joining data tables</a>
    </li>
    <li>
      <a href="Week03d.html">Working with string objects</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 05</li>
    <li>
      <a href="Week04a.html">The base plotting environment</a>
    </li>
    <li>
      <a href="Week04b.html">The lattice plotting environment</a>
    </li>
    <li>
      <a href="Week04c.html">The ggplot plotting environment</a>
    </li>
    <li>
      <a href="Week04d.html">Manipulating colors in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Univariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 06</li>
    <li>
      <a href="Week05a.html">Visualizing univariate data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 07</li>
    <li>
      <a href="Week05b.html">Comparing univariate data distributions</a>
    </li>
    <li>
      <a href="Week06a.html">Theoretical Q-Q plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 08</li>
    <li>
      <a href="Week07a.html">Fits and residuals</a>
    </li>
    <li>
      <a href="Week07b.html">Spread-location plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 09</li>
    <li>
      <a href="Week08a.html">Re-expressing data</a>
    </li>
    <li>
      <a href="Week08b.html">Letter value summaries</a>
    </li>
    <li>
      <a href="Week08c.html">The Two R’s of EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bivariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 10</li>
    <li>
      <a href="Week09a.html">Bivariate analysis</a>
    </li>
    <li>
      <a href="Week09b.html">Resistant lines</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 11</li>
    <li>
      <a href="Week10a.html">The third R of EDA: Residuals</a>
    </li>
    <li>
      <a href="Week10b.html">Detecting discontinuities in the data</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/regression.html">Details of the OLS regression method (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Two-way tables
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 12</li>
    <li>
      <a href="Week11a.html">Median polish/Mean polish</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/ANOVA.html">Details of an ANOVA (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 13</li>
    <li>
      <a href="Week12a.html">Creating maps in R</a>
    </li>
    <li class="dropdown-header">Connecting to relational databases</li>
  </ul>
</li>
<li>
  <a href="Data.html">Datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans%7CSource+Code+Pro" rel="stylesheet">

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Week4: Lattice plotting environment</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#data">Data</a></li>
<li><a href="#the-lattice-package">The <code>lattice</code> package</a></li>
<li><a href="#displaying-univariate-distributions">Displaying univariate distributions</a></li>
<li><a href="#visualizing-multivariate-data">Visualizing multivariate data</a><ul>
<li><a href="#basic-line-plots">Basic line plots</a></li>
<li><a href="#scatter-plots">Scatter plots</a></li>
</ul></li>
<li><a href="#customizing-trellis-plots">Customizing trellis plots</a></li>
</ul>
</div>

<div style="color:#ff7535; background-color:#fff0ee ;   border-left-style: solid">
<p>This tutorial makes use of the following R package(s): <strong><code>lattice</code></strong></p>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<p>The data files used in this tutorial were created in an <a href="Week03ab_examples.html">earlier exercise</a>. Type the following command to download the objects</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">load</span>(<span class="kw">url</span>(<span class="st">&quot;http://mgimond.github.io/ES218/Data/dat1_2.RData&quot;</span>))</code></pre></div>
<p>This should load several data frame objects into your R session (note that not all are used in this exercise). The first three lines of data frames used in the following sections are shown below:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dat1l, <span class="dv">3</span>)</code></pre></div>
<pre><code>  Year   Crop    Yield
1 1961 Barley 16488.52
2 1962 Barley 18839.00
3 1963 Barley 18808.27</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dat1w, <span class="dv">3</span>)</code></pre></div>
<pre><code>  Year   Barley Buckwheat    Maize     Oats      Rye
1 1961 16488.52  10886.67 39183.63 15171.26 11121.79
2 1962 18839.00  11737.50 40620.80 16224.60 12892.77
3 1963 18808.27  11995.00 42595.55 16253.04 11524.11</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dat2b, <span class="dv">3</span>)</code></pre></div>
<pre><code>  State  County Level Gender value Region
1    al Autauga   All    All 35881  South
2    al Baldwin   All    All 31439  South
3    al Barbour   All    All 25201  South</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dat2c, <span class="dv">3</span>)</code></pre></div>
<pre><code>  State                 County Level Region   All     F     M
1    ak Aleutians East Borough   All   West 21953 20164 22940
2    ak Aleutians East Borough  NoHS   West 21953 19250 22885
3    ak Aleutians East Borough    HS   West 20770 19671 21192</code></pre>
</div>
<div id="the-lattice-package" class="section level1">
<h1>The <code>lattice</code> package</h1>
<p>The <code>lattice</code> package is an implementation of the <strong>Trellis</strong> display (or multi-panel display) used to visualize multivariate data or, more specifically, to visualize the dependencies and interactions between multiple variables. For example, the following lattice (or Trellis) plot displays the counts of people (grouped by gender, adult/child and economic status or crew) who perished on the Titanic.</p>
<p><img src="Week04b_files/figure-html/unnamed-chunk-3-1.png" width="480" /></p>
<p>In the following example, a scatter plot is produced for different crime types by US region.</p>
<p><img src="Week04b_files/figure-html/unnamed-chunk-4-1.png" width="480" /></p>
<p>Examples of some of the most common lattice plot types follow. Note that you will need to load the <code>lattice</code> package to run the following chunks of code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)</code></pre></div>
</div>
<div id="displaying-univariate-distributions" class="section level1">
<h1>Displaying univariate distributions</h1>
<p>Let’s look at a simple example where the density distribution of yields (across all years) is conditioned on crop type.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">densityplot</span>( <span class="op">~</span><span class="st"> </span>Yield <span class="op">|</span><span class="st"> </span>Crop, dat1l, <span class="dt">plot.points =</span> <span class="st">&quot;&quot;</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-6-1.png" width="672" /></p>
<p>The <code>layout=c(5,1)</code> parameter instructs the lattice function to layout the panels along 5 column and 1 row. If you wanted the plots to be displayed in 5 rows and 1 column you would simply type <code>layout=c(1,5)</code>.</p>
<p>The first thing to note is that the x-scale axis range is the same for all five plots. At first, this may seem as an inefficient use of the range of x values–for example, the buckwheat density plot is squeezed in the left-hand side of the plot, but it is important to understand the purpose of a trellis plot: <strong>to facilitate comparison of plots</strong>. By ensuring that all scale ranges remain the same, we can easily compare the plot shape. In the above plot, it is clear that the yield of buckwheat remains consistent across the years compared to Maize which displays the greatest variability across the years.</p>
<p>The <code>lattice</code> package also has a histogram function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">histogram</span>( <span class="op">~</span><span class="st"> </span>Yield <span class="op">|</span><span class="st"> </span>Crop, dat1l, <span class="dt">plot.points =</span> <span class="st">&quot;&quot;</span>, <span class="dt">nint =</span> <span class="dv">20</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>Note the importance of having a table shaped in “long form”. The density plots are conditioned on <em>crop type</em> which requires that crop type be treated as different values of a same variable (i.e. column <code>Crop</code> in <code>dat1l</code>). The above plot could not be generated had crop types been treated as variables (i.e. columns) as in <code>dat1w</code>.</p>
<p>You can also compare the distributions to a <em>normal</em> distribution (i.e. a Q-Q plot):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqmath</span>( <span class="op">~</span><span class="st"> </span>Yield <span class="op">|</span><span class="st"> </span>Crop, dat1l, <span class="dt">plot.points =</span> <span class="st">&quot;&quot;</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>Boxplots are another popular way to view the distribution of values. In the following example, we create boxplots of income values as a function of gender (<code>value ~ Gender</code>) and condition this comparison on educational levels (<code>| Level</code>). Since the variable <code>Gender</code> contains three unique values (<code>M</code>, <code>F</code> and <code>All</code>) we will remove all records tied to the whole population (<code>All</code>) by passing a condition, <code>dat2b$Gender != &quot;All&quot;</code> (where <code>!=</code> is interpreted as “not equal to”), to the <code>dat2b</code> index.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bwplot</span>(value <span class="op">~</span><span class="st"> </span>Gender <span class="op">|</span><span class="st"> </span>Level, dat2b[dat2b<span class="op">$</span>Gender <span class="op">!=</span><span class="st"> &quot;All&quot;</span>,] , <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>The <code>bwplot</code> automatically orders the conditional variable lexicographically which makes little sense here. It would be best to sort the attainment values based on their educational hierarchy. This will require two steps: converting the <code>Level</code> field to a factor using the <code>factor()</code> function, then ordering the elements of the factor using the <code>levels</code> parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2b<span class="op">$</span>Level &lt;-<span class="st"> </span><span class="kw">factor</span>(dat2b<span class="op">$</span>Level, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;All&quot;</span>, <span class="st">&quot;NoHS&quot;</span>, <span class="st">&quot;HS&quot;</span>, <span class="st">&quot;AD&quot;</span>, <span class="st">&quot;BD&quot;</span>, <span class="st">&quot;Grad&quot;</span> )) 

<span class="kw">bwplot</span>(value <span class="op">~</span><span class="st"> </span>Gender <span class="op">|</span><span class="st"> </span>Level, dat2b[dat2b<span class="op">$</span>Gender <span class="op">!=</span><span class="st"> &quot;All&quot;</span>,] , <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>We may remove the outliers by passing the <code>do.out = FALSE</code> parameter to <code>bwplot</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bwplot</span>(value <span class="op">~</span><span class="st"> </span>Gender <span class="op">|</span><span class="st"> </span>Level, dat2b[dat2b<span class="op">$</span>Gender <span class="op">!=</span><span class="st"> &quot;All&quot;</span>,] , <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>), <span class="dt">do.out =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>But note that the y-axis range still reflects the outlier values. We will need to explicitly define the y limits using the <code>ylim=</code> parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bwplot</span>(value <span class="op">~</span><span class="st"> </span>Gender <span class="op">|</span><span class="st"> </span>Level, dat2b[dat2b<span class="op">$</span>Gender <span class="op">!=</span><span class="st"> &quot;All&quot;</span>,] , <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>), <span class="dt">do.out =</span> <span class="ot">FALSE</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">125000</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>
<div id="visualizing-multivariate-data" class="section level1">
<h1>Visualizing multivariate data</h1>
<div id="basic-line-plots" class="section level2">
<h2>Basic line plots</h2>
<p>The Lattice package allows us to plot several variables on a same plot. For example, we can plot yields vs year for each crop on a same plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyplot</span>(Barley <span class="op">+</span><span class="st"> </span>Buckwheat <span class="op">+</span><span class="st"> </span>Maize <span class="op">+</span><span class="st"> </span>Oats <span class="op">+</span><span class="st"> </span>Rye <span class="op">~</span><span class="st"> </span>Year , dat1w, <span class="dt">type =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">20</span>,
        <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">lines =</span> <span class="ot">TRUE</span>, <span class="dt">space =</span> <span class="st">&quot;right&quot;</span>),
        <span class="dt">main =</span> <span class="st">&quot;Grain yield&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Yield&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-13-1.png" width="576" /></p>
<p>Note the use of the wide version (<code>dat1w</code>) of the original <code>dat1</code> dataset. Each crop is treated as its own variable (column) and is added to the plot using the <code>+</code> symbol.</p>
<p>We can also split the plots across a Trellis system by conditioning yields on crop type. But this now requires the use of the long form of the data (i.e. <code>dat1l</code>). The next plot also differs from the previous plot in that we substitute a point-line symbol (<code>type=&quot;o&quot;</code>) with a line symbol only (<code>type=&quot;l&quot;</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyplot</span>(Yield <span class="op">~</span><span class="st"> </span>Year <span class="op">|</span><span class="st"> </span>Crop, dat1l, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">layout=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">1</span>),
       <span class="dt">main =</span> <span class="st">&quot;Grain yield&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Yield&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
</div>
<div id="scatter-plots" class="section level2">
<h2>Scatter plots</h2>
<p>One key benefit of a Trellis system is its ability to generate bivariate scatter plots conditioned on one or more variables. For example, we may wish to compare incomes between female and male for each county and condition this relationship on educational attainment. This requires that male and female be assigned their own columns (since they are now treated as variables) and that educational attainment be assigned as another column whose values are each levels of educational attainment. We will therefore use <code>dat2c</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2c<span class="op">$</span>Level &lt;-<span class="st"> </span><span class="kw">factor</span>(dat2c<span class="op">$</span>Level, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;All&quot;</span>, <span class="st">&quot;NoHS&quot;</span>, <span class="st">&quot;HS&quot;</span>, <span class="st">&quot;AD&quot;</span>, <span class="st">&quot;BD&quot;</span>, <span class="st">&quot;Grad&quot;</span> )) 

<span class="kw">xyplot</span>( M <span class="op">~</span><span class="st"> </span>F <span class="op">|</span><span class="st"> </span>Level, dat2c, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;p&quot;</span>,<span class="st">&quot;g&quot;</span>), <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex=</span><span class="fl">0.6</span>,
        <span class="dt">col.symbol=</span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.1</span>), <span class="dt">aspect=</span><span class="st">&quot;iso&quot;</span>, <span class="dt">abline=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">layout=</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>),
        <span class="dt">xlab=</span><span class="st">&quot;Female income ($)&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Male income($)&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-15-1.png" width="768" /></p>
<p>The <code>xyplot</code> function is passed several parameters. The parameter <code>type = c(&quot;p&quot;,&quot;g&quot;)</code> instructs the function to generate both points, <code>&quot;p&quot;</code>, and a background grid ,<code>&quot;g&quot;</code>. Parameter <code>type</code> can accept many other options, a few are listed in the following table:</p>
<table>
<thead>
<tr class="header">
<th>Option</th>
<th>Adds…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&quot;p&quot;</code></td>
<td>Points</td>
</tr>
<tr class="even">
<td><code>&quot;l&quot;</code></td>
<td>Lines</td>
</tr>
<tr class="odd">
<td><code>&quot;b&quot;</code></td>
<td>Both points and lines</td>
</tr>
<tr class="even">
<td><code>&quot;o&quot;</code></td>
<td>Both points and lines</td>
</tr>
<tr class="odd">
<td><code>&quot;r&quot;</code></td>
<td>Regression line</td>
</tr>
<tr class="even">
<td><code>&quot;g&quot;</code></td>
<td>Reference grid</td>
</tr>
<tr class="odd">
<td><code>&quot;smooth&quot;</code></td>
<td>LOESS fit</td>
</tr>
<tr class="even">
<td><code>&quot;spline&quot;</code></td>
<td>Cubic spline fit</td>
</tr>
</tbody>
</table>
<p>The parameters <code>pch</code> and <code>cex</code> define the symbol shape and size. The parameter <code>col.symbol</code> defines the point color. The parameter <code>aspect=&quot;iso&quot;</code> sets the aspect ratio in such a way that a unit of measure along x matches that of y, this facilitates income comparison between both sexes since the scales match exactly. The parameter <code>abline=c(0,1)</code> generated a 45° line. If median incomes for male and female were identical in each county, the points would line up along the 45° line. Most points are above the line indicating that male income is greater than female income when aggregated at the county level.</p>
<p>Note that the point distribution seems skewed. We can warp the values in a <code>log()</code> function to help reveal the relationship between male and female income:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyplot</span>( <span class="kw">log</span>(M) <span class="op">~</span><span class="st"> </span><span class="kw">log</span>(F) <span class="op">|</span><span class="st"> </span>Level, dat2c, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;p&quot;</span>,<span class="st">&quot;g&quot;</span>), <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex=</span><span class="fl">0.6</span>,
        <span class="dt">col.symbol=</span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.1</span>), <span class="dt">aspect=</span><span class="st">&quot;iso&quot;</span>, <span class="dt">abline=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">layout=</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>),
        <span class="dt">xlab=</span><span class="st">&quot;Log of female income ($)&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Log of male income($)&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-16-1.png" width="768" /></p>
<p>We can take this a step further. We could condition the relationship in income between male and female on both educational attainment and states or regions. We won’t condition the scatterplot on states as this would generate 50 x 6 separate plots, so we will condition the plots on region.</p>
<p>Note that since the output will consist of 6 (levels) x 4 (regions) we will need to modify the <code>layout</code> parameter to <code>layout=c(6,4)</code>. We will also stick with the log transformation of income since it seems to do a good job in helping reveal the relationship between both income values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyplot</span>( M <span class="op">~</span><span class="st"> </span>F <span class="op">|</span><span class="st"> </span>Level <span class="op">+</span><span class="st"> </span>Region, dat2c, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;p&quot;</span>,<span class="st">&quot;g&quot;</span>), <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex=</span><span class="fl">0.6</span>,
        <span class="dt">col.symbol=</span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.1</span>), <span class="dt">aspect=</span><span class="st">&quot;iso&quot;</span>, <span class="dt">abline=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">layout=</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">4</span>),
        <span class="dt">xlab=</span><span class="st">&quot;Log of female income ($)&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Log of male income($)&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-17-1.png" width="768" /></p>
</div>
</div>
<div id="customizing-trellis-plots" class="section level1">
<h1>Customizing trellis plots</h1>
<p>Various elements of a trellis plot can be customized by passing the graphic parameters to the <code>trellis.par.set()</code> function. To get the list of graphic parameters and their values call the <code>trellis.par.get()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">trellis.par.get</span>()</code></pre></div>
<p>Output for three parameters is shown below:</p>
<pre><code> $ fontsize         :List of 2
  ..$ text  : num 12
  ..$ points: num 8
 $ strip.background :List of 2
  ..$ col  : chr [1:7] &quot;#DFDFDF&quot; &quot;#BFBFBF&quot; &quot;#9F9F9F&quot; &quot;#808080&quot; ...
 $ superpose.polygon:List of 5
  ..$ alpha : num [1:7] 1 1 1 1 1 1 1
  ..$ col   : chr [1:7] &quot;#FBB4AE&quot; &quot;#B3CDE3&quot; &quot;#CCEBC5&quot; &quot;#DECBE4&quot; ...
  ..$ border: chr &quot;black&quot;
  ..$ lty   : num [1:7] 1 1 1 1 1 1 1
  ..$ lwd   : num [1:7] 1 1 1 1 1 1 1</code></pre>
<p>Each parameter consists of a list of elements. For example, the graphic parameter <code>fontsize</code> is made up of two modifiable elements: <code>text</code> and <code>points</code>. The following figure shows a few of the parameters and their associated graphical element:</p>
<div class="figure">
<img src="img/Trellis_anatomy.png" />

</div>
<p>For example, we will modify the Titanic survival barchart by changing the strip background colors, the bar polygon colors, the text size and color and the label size and color as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define an array of colors. The first array generates unique hues while the </span>
<span class="co"># second generates different shades of grey</span>
col.qual &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#FBB4AE&quot;</span>,<span class="st">&quot;#B3CDE3&quot;</span>,<span class="st">&quot;#CCEBC5&quot;</span>,<span class="st">&quot;#DECBE4&quot;</span>,<span class="st">&quot;#FED9A6&quot;</span>,<span class="st">&quot;#FFFFCC&quot;</span>,<span class="st">&quot;#E5D8BD&quot;</span>)
col.grey &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#DFDFDF&quot;</span>,<span class="st">&quot;#BFBFBF&quot;</span>,<span class="st">&quot;#9F9F9F&quot;</span>,<span class="st">&quot;#808080&quot;</span>,<span class="st">&quot;#606060&quot;</span>,<span class="st">&quot;#404040&quot;</span>,<span class="st">&quot;#202020&quot;</span>)

<span class="co"># Modify the Trellis parameters</span>
<span class="kw">trellis.par.set</span>(<span class="dt">superpose.polygon =</span> <span class="kw">list</span>(<span class="dt">col =</span> col.qual, <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>))
<span class="kw">trellis.par.set</span>(<span class="dt">strip.background =</span> <span class="kw">list</span>(<span class="dt">col =</span> col.grey))
<span class="kw">trellis.par.set</span>(<span class="dt">add.text =</span> <span class="kw">list</span>(<span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">col=</span><span class="st">&quot;grey20&quot;</span>))
<span class="kw">trellis.par.set</span>(<span class="dt">par.xlab.text =</span> <span class="kw">list</span>(<span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">col=</span><span class="st">&quot;grey20&quot;</span>))

<span class="co"># Now generate the strip charts</span>
<span class="kw">barchart</span>(Class <span class="op">~</span><span class="st"> </span>Freq <span class="op">|</span><span class="st"> </span>Sex <span class="op">+</span><span class="st"> </span>Age, <span class="dt">data =</span> <span class="kw">as.data.frame</span>(Titanic), 
         <span class="dt">groups =</span> Survived, <span class="dt">stack =</span> <span class="ot">TRUE</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>),
         <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;Survived&quot;</span>, <span class="dt">columns =</span> <span class="dv">2</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>You’ll note that some of the elements are composed of more than one value such as <code>strip.background</code>’s <code>col</code> element which takes on 7 distinct color values. We did not need to modify all seven since only the first two were used (one for age group and the other for gender). Had we conditioned the plot on a third parameter, a third strip would have been added and the third color in <code>col.grey</code> would have been used. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barchart</span>(Class <span class="op">~</span><span class="st"> </span>Freq <span class="op">|</span><span class="st"> </span>Sex <span class="op">+</span><span class="st"> </span>Age <span class="op">+</span><span class="st"> </span>Survived, <span class="dt">data =</span> <span class="kw">as.data.frame</span>(Titanic), 
         <span class="dt">groups =</span> Survived, <span class="dt">stack =</span> <span class="ot">TRUE</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">2</span>),
         <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;Survived&quot;</span>, <span class="dt">columns =</span> <span class="dv">2</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Note the third strip (Yes vs No) with the third background color (#9F9F9F) in the color array <code>col.grey</code>.</p>
</div>


<div class="footer">
<hr/>
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>  Manny Gimond (2018)
</br>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
