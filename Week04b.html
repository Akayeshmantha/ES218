<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Week4: Lattice plotting environment</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs\style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 02</li>
    <li>
      <a href="Week02a.html">Data types</a>
    </li>
    <li>
      <a href="Week02b.html">Reading and writing data files</a>
    </li>
    <li>
      <a href="Week02c.html">Working with date objects</a>
    </li>
    <li>
      <a href="Week02d.html">Exploring and cleaning dataframes using base functions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 03</li>
    <li>
      <a href="Week03a.html">Manipulating dataframes with dplyr</a>
    </li>
    <li>
      <a href="Week03b.html">Tidying/reshaping tables using tidyr</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 04</li>
    <li>
      <a href="Week03c.html">Joining data tables</a>
    </li>
    <li>
      <a href="Week03d.html">Working with string objects</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 05</li>
    <li>
      <a href="Week04a.html">The base plotting environment</a>
    </li>
    <li>
      <a href="Week04b.html">The lattice plotting environment</a>
    </li>
    <li>
      <a href="Week04c.html">The ggplot plotting environment</a>
    </li>
    <li>
      <a href="Week04d.html">Manipulating colors in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Univariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 06</li>
    <li>
      <a href="Week05a.html">Visualizing univariate data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 07</li>
    <li>
      <a href="Week05b.html">Comparing univariate data distributions</a>
    </li>
    <li>
      <a href="Week06a.html">Theoretical Q-Q plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 08</li>
    <li>
      <a href="Week07a.html">Fits and residuals</a>
    </li>
    <li>
      <a href="Week07b.html">Spread-location plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 09</li>
    <li>
      <a href="Week08a.html">Re-expressing data</a>
    </li>
    <li>
      <a href="Week08b.html">Letter value summaries</a>
    </li>
    <li>
      <a href="Week08c.html">The Two R’s of EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bivariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 10</li>
    <li>
      <a href="Week09a.html">Bivariate analysis</a>
    </li>
    <li>
      <a href="Week09b.html">Resistant lines</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 11</li>
    <li>
      <a href="Week10a.html">The third R of EDA: Residuals</a>
    </li>
    <li>
      <a href="Week10b.html">Detecting discontinuities in the data</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/regression.html">Details of the OLS regression method (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Two-way tables
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 12</li>
    <li>
      <a href="Week11a.html">Median polish/Mean polish</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/ANOVA.html">Details of an ANOVA (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 13</li>
    <li>
      <a href="Week12a.html">Creating maps in R</a>
    </li>
    <li class="dropdown-header">Connecting to relational databases</li>
  </ul>
</li>
<li>
  <a href="Data.html">Datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Week4: Lattice plotting environment</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#data">Data</a><ul>
<li><a href="#dataset-dat1">Dataset <code>dat1</code></a></li>
<li><a href="#dataset-dat2">Dataset <code>dat2</code></a></li>
</ul></li>
<li><a href="#the-lattice-package">The <code>lattice</code> package</a></li>
<li><a href="#displaying-univariate-distributions">Displaying univariate distributions</a></li>
<li><a href="#visualizing-multivariate-data">Visualizing multivariate data</a><ul>
<li><a href="#basic-line-plots">Basic line plots</a></li>
<li><a href="#scatter-plots">Scatter plots</a></li>
</ul></li>
<li><a href="#customizing-trellis-plots">Customizing trellis plots</a></li>
</ul>
</div>

<div style="color:#ff7535; background-color:#fff0ee ;   border-left-style: solid">
<p>This tutorial makes use of the following R package(s): <strong><code>dplyr</code></strong>, <strong><code>tidyr</code></strong>, <strong><code>lattice</code></strong></p>
</div>
<div id="data" class="section level1">
<h1>Data</h1>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://mgimond.github.io/ES218/Data/FAO_grains_NA.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)
dat2 &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://mgimond.github.io/ES218/Data/Income_education.csv&quot;</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</code></pre></div>
<div id="dataset-dat1" class="section level2">
<h2>Dataset <code>dat1</code></h2>
<p><code>dat1</code> consists of grain yields by north american countries and by year. The data set was downloaded from <a href="http://faostat3.fao.org/" class="uri">http://faostat3.fao.org/</a> in June of 2014.</p>
<p>A subset of <code>dat1</code> will be used in this tutorial in both a <em>wide</em> form and a <em>long</em> form. The wide form will be called <code>dat1w</code> and will be a table of year vs. crop yields.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(tidyr)
dat1w &lt;-<span class="st"> </span>dat1 %&gt;%
<span class="st">  </span><span class="kw">filter</span>(Information ==<span class="st"> &quot;Yield (Hg/Ha)&quot;</span>, 
         Country     ==<span class="st">&quot;United States of America&quot;</span>, 
         Crop       %in%<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Oats&quot;</span>, <span class="st">&quot;Maize&quot;</span>, <span class="st">&quot;Barley&quot;</span>, <span class="st">&quot;Buckwheat&quot;</span>,<span class="st">&quot;Rye&quot;</span>)) %&gt;%
<span class="st">  </span><span class="kw">select</span>(Year, Crop, Value)   %&gt;%
<span class="st">  </span><span class="kw">spread</span>(<span class="dt">key =</span> Crop, <span class="dt">value=</span><span class="st">&quot;Value&quot;</span>)
<span class="kw">head</span>(dat1w)</code></pre></div>
<pre><code>  Year   Barley Buckwheat    Maize     Oats      Rye
1 1961 16488.52  10886.67 39183.63 15171.26 11121.79
2 1962 18839.00  11737.50 40620.80 16224.60 12892.77
3 1963 18808.27  11995.00 42595.55 16253.04 11524.11
4 1964 20208.88  11566.50 39498.36 15471.55 12026.24
5 1965 23070.58  11875.00 46492.14 18001.04 14192.91
6 1966 20581.66  11956.52 45891.88 16117.92 13670.75</code></pre>
<p>The <em>long</em> form version of the subset will be called <code>dat1l</code> and will be a <em>long</em> form representation of <code>dat1w</code> (yield by crop and year).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat1l &lt;-<span class="st"> </span><span class="kw">gather</span>(dat1w, <span class="dt">key =</span> <span class="st">&quot;Crop&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;Yield&quot;</span>, <span class="dv">2</span>:<span class="dv">6</span>)
<span class="kw">head</span>(dat1l,<span class="dv">10</span>)</code></pre></div>
<pre><code>   Year   Crop    Yield
1  1961 Barley 16488.52
2  1962 Barley 18839.00
3  1963 Barley 18808.27
4  1964 Barley 20208.88
5  1965 Barley 23070.58
6  1966 Barley 20581.66
7  1967 Barley 21785.30
8  1968 Barley 23557.07
9  1969 Barley 24039.46
10 1970 Barley 23048.77</code></pre>
</div>
<div id="dataset-dat2" class="section level2">
<h2>Dataset <code>dat2</code></h2>
<p><code>dat2</code> consists of county income and educational attainment for both the male and female population. A codebook, <a href="http://mgimond.github.io/ES218/Data/Income_education_codebook.csv">available here</a>, provides descriptions for the different codes. We will remove the cases (rows) from <code>dat2</code> for which values are missing (i.e. cases having a <code>NA</code> designation) since these rows will serve no purpose (such cases may be associated with counties having no year-round residents or a resident population too small for data dissemination).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2 &lt;-<span class="st"> </span><span class="kw">na.omit</span>(dat2)</code></pre></div>
<p>As with <code>dat1</code>, we will create long forms of <code>dat2</code> for use with <code>lattice</code> plotting routines.</p>
<p>The <code>dat2</code> dataset has income data broken down by educational attainment and gender. It would therefore be convenient for subsequent plot operations if two variables, <code>Gender</code> and (educational) <code>Level</code>, were added to the long table version of <code>dat2</code>.</p>
<p>We will first generate five educational category vectors whose values are the census data variable names (see the codebook for census variable name descriptions). These category vectors will then be used in the chain operation’s <code>ifelse</code> functions. We then generate two category vectors for male and female groups–note the use of the <code>paste()</code> function in lieu of the combine function <code>c()</code> (which could have been used as well). Also note that <code>dat2</code> has income values for <em>all</em> sexes and <em>all</em> educational attainments. We did not create categories for this since they present the “else” option in the <code>ifelse</code> function. In other words, if a variable such as <code>B20004001</code> is not in any of the educational category vectors (e.g. <code>NoHS</code>, <code>HS</code>, etc…), then its <code>Level</code> value will be <code>&quot;All&quot;</code>. Likewise, if the variable is not in either <code>Male</code> or <code>Female</code> vectors, then the value <code>&quot;All&quot;</code> will be assigned to <code>Gender</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Create list of variable names associated with each level</span>
<span class="co"># of educational attainment</span>
NoHS &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B20004002&quot;</span>, <span class="st">&quot;B20004008&quot;</span>, <span class="st">&quot;B20004014&quot;</span>)  <span class="co"># Less than High School</span>
HS   &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B20004003&quot;</span>, <span class="st">&quot;B20004009&quot;</span>, <span class="st">&quot;B20004015&quot;</span>)  <span class="co"># High School</span>
AD   &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B20004004&quot;</span>, <span class="st">&quot;B20004010&quot;</span>, <span class="st">&quot;B20004016&quot;</span>)  <span class="co"># Some college or associates degree</span>
BD   &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B20004005&quot;</span>, <span class="st">&quot;B20004011&quot;</span>, <span class="st">&quot;B20004017&quot;</span>)  <span class="co"># Bachelor&#39;s degree</span>
Grad &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;B20004006&quot;</span>, <span class="st">&quot;B20004012&quot;</span>, <span class="st">&quot;B20004018&quot;</span>)  <span class="co"># Graduate or professional degree</span>

<span class="co"># Create list of variable names associated with each gender</span>
Male   &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;B200040&quot;</span>, <span class="kw">sprintf</span>(<span class="st">&quot;%02i&quot;</span>, <span class="dv">7</span>:<span class="dv">12</span>), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)
Female &lt;-<span class="st"> </span><span class="kw">paste</span>(<span class="st">&quot;B200040&quot;</span>, <span class="kw">sprintf</span>(<span class="st">&quot;%02i&quot;</span>, <span class="dv">13</span>:<span class="dv">18</span>), <span class="dt">sep =</span> <span class="st">&quot;&quot;</span>)

<span class="co"># Create a long form of the data, and add </span>
<span class="co"># descriptive columns for level attained and gender</span>
dat2b &lt;-<span class="st"> </span>dat2 %&gt;%
<span class="st">  </span><span class="kw">gather</span>(<span class="dt">key =</span> <span class="st">&quot;variable&quot;</span>, <span class="dt">value =</span> <span class="st">&quot;value&quot;</span>, -<span class="dv">1</span>:-<span class="dv">2</span>)  %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Level =</span> <span class="kw">ifelse</span>(variable %in%<span class="st"> </span>NoHS, <span class="st">&quot;NoHS&quot;</span>, 
                        <span class="kw">ifelse</span>(variable %in%<span class="st"> </span>HS, <span class="st">&quot;HS&quot;</span>,
                               <span class="kw">ifelse</span>(variable %in%<span class="st"> </span>AD, <span class="st">&quot;AD&quot;</span>,
                                      <span class="kw">ifelse</span>(variable %in%<span class="st"> </span>BD, <span class="st">&quot;BD&quot;</span>,
                                             <span class="kw">ifelse</span>(variable %in%<span class="st"> </span>Grad, <span class="st">&quot;Grad&quot;</span>, <span class="st">&quot;All&quot;</span>)))))) %&gt;%
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Gender =</span> <span class="kw">ifelse</span>(variable %in%<span class="st"> </span>Male, <span class="st">&quot;M&quot;</span>, 
                         <span class="kw">ifelse</span>(variable %in%<span class="st"> </span>Female, <span class="st">&quot;F&quot;</span>, <span class="st">&quot;All&quot;</span>)))                         %&gt;%
<span class="st">  </span><span class="kw">select</span>(State, County, Level, Gender, value)
<span class="kw">head</span>(dat2b)</code></pre></div>
<pre><code>  State  County Level Gender value
1    al Autauga   All    All 35881
2    al Baldwin   All    All 31439
3    al Barbour   All    All 25201
4    al    Bibb   All    All 29016
5    al  Blount   All    All 32035
6    al Bullock   All    All 26408</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tail</span>(dat2b)</code></pre></div>
<pre><code>      State     County Level Gender value
55201    wy   Sublette  Grad      F 59683
55202    wy Sweetwater  Grad      F 63681
55203    wy      Teton  Grad      F 48357
55204    wy      Uinta  Grad      F 52321
55205    wy   Washakie  Grad      F 50341
55206    wy     Weston  Grad      F 56765</code></pre>
<p>Note that we have eliminated references to variable names such as “B20004001” from <code>dat2b</code> making it easier to interpret the variable names/values.</p>
<p>In <code>dat2b</code> the genders are lumped under a single <code>Gender</code> variable. We may wish to have male and female incomes assigned their own columns so we will need to <em>widen</em> <code>dat2b</code> so that each gender value is given its own column. We will use the <code>spread</code> function from the <code>tidyr</code> package to create a new data frame called <code>dat2.gender</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2c &lt;-<span class="st"> </span><span class="kw">spread</span>(dat2b, <span class="dt">key =</span> Gender, <span class="dt">value =</span> value )</code></pre></div>
<p>We will also take this opportunity to add a new field to <code>dat2c</code> called <code>Region</code> which will associated each state with a region. R has a built-in vector called <code>state.region</code> that assigns a region to each state.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">state.region</code></pre></div>
<pre><code> [1] South         West          West          South         West          West          Northeast     South        
 [9] South         South         West          West          North Central North Central North Central North Central
[17] South         South         Northeast     South         Northeast     North Central North Central South        
[25] North Central West          North Central West          Northeast     Northeast     West          Northeast    
[33] South         North Central North Central South         West          Northeast     Northeast     South        
[41] North Central South         South         West          Northeast     South         West          South        
[49] North Central West         
Levels: Northeast South North Central West</code></pre>
<p>However, you’ll note that this vector only has region names but makes no reference to states. It’s intended to be used with another built-in data vector called <code>state.abb</code> or <code>state.name</code>. We will combine <code>state.abb</code> with <code>state.region</code> to create a data frame “lookup table”. We will also need to convert the uppercase state abbreviations to lower case using <code>tolower</code> so that they match the <code>dat2b</code>’s lowercase state abbreviations.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">st.reg &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">State =</span> <span class="kw">tolower</span>(state.abb), <span class="dt">Region =</span> state.region)</code></pre></div>
<p>Our income dataset has data for all 50 states as well as the District of Columbia (D.C.) as shown in the following output:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">unique</span>(dat2c$State)</code></pre></div>
<pre><code> [1] ak al ar az ca co ct dc de fl ga hi ia id il in ks ky la ma md me mi mn mo ms mt nc nd ne nh nj nm nv ny oh ok or
[39] pa ri sc sd tn tx ut va vt wa wi wv wy
51 Levels: ak al ar az ca co ct dc de fl ga hi ia id il in ks ky la ma md me mi mn mo ms mt nc nd ne nh nj nm nv ... wy</code></pre>
<p>But D.C. is not included in the built-in states dataset, so we will add this record the the <code>st.reg</code> table and assign D.C. to the <code>South</code> region.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">st.reg &lt;-<span class="st"> </span><span class="kw">rbind</span>(st.reg , <span class="kw">data.frame</span>(<span class="dt">State=</span><span class="st">&quot;dc&quot;</span>, <span class="dt">Region=</span><span class="st">&quot;South&quot;</span>) )</code></pre></div>
<p>Now we’ll join this look-up table to the <code>dat2c</code> data frame. We’ll use <code>dplyr</code>s <code>inner_join</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2c &lt;-<span class="st"> </span><span class="kw">inner_join</span>(dat2c, st.reg, <span class="dt">by =</span> <span class="st">&quot;State&quot;</span>)
<span class="kw">head</span>(dat2c)</code></pre></div>
<pre><code>  State                 County Level   All     F     M Region
1    ak Aleutians East Borough    AD 26383 26750 26352   West
2    ak Aleutians East Borough   All 21953 20164 22940   West
3    ak Aleutians East Borough    BD 22431 19592 27875   West
4    ak Aleutians East Borough  Grad 74000 74000 71250   West
5    ak Aleutians East Borough    HS 20770 19671 21192   West
6    ak Aleutians East Borough  NoHS 21953 19250 22885   West</code></pre>
</div>
</div>
<div id="the-lattice-package" class="section level1">
<h1>The <code>lattice</code> package</h1>
<p>The <code>lattice</code> package is an implementation of the <strong>Trellis</strong> display (or multi-panel display) used to visualize multivariate data or, more specifically, to visualize the dependencies and interactions between multiple variables. For example, the following lattice (or Trellis) plot displays the counts of people (grouped by gender, adult/child and economic status or crew) who perished on the Titanic.</p>
<p><img src="Week04b_files/figure-html/unnamed-chunk-13-1.png" width="480" /></p>
<p>In the following example, a scatter plot is produced for different crime types by US region.</p>
<p><img src="Week04b_files/figure-html/unnamed-chunk-14-1.png" width="480" /></p>
<p>Examples of some of the most common lattice plot types follow. Note that you will need to load the <code>lattice</code> package to run the following chunks of code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)</code></pre></div>
</div>
<div id="displaying-univariate-distributions" class="section level1">
<h1>Displaying univariate distributions</h1>
<p>Let’s look at a simple example where the density distribution of yields (across all years) is conditioned on crop type.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">densityplot</span>( ~<span class="st"> </span>Yield |<span class="st"> </span>Crop, dat1l, <span class="dt">plot.points =</span> <span class="st">&quot;&quot;</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p>The <code>layout=c(5,1)</code> parameter instructs the lattice function to layout the panels along 5 column and 1 row. If you wanted the plots to be displayed in 5 rows and 1 column you would simply type <code>layout=c(1,5)</code>.</p>
<p>The first thing to note is that the x-scale axis range is the same for all five plots. At first, this may seem as an inefficient use of the range of x values–for example, the buckwheat density plot is squeezed in the left-hand side of the plot, but it is important to understand the purpose of a trellis plot: <strong>to facilitate comparison of plots</strong>. By ensuring that all scale ranges remain the same, we can easily compare the plot shape. In the above plot, it is clear that the yield of buckwheat remains consistent across the years compared to Maize which displays the greatest variability across the years.</p>
<p>The <code>lattice</code> package also has a histogram function:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">histogram</span>( ~<span class="st"> </span>Yield |<span class="st"> </span>Crop, dat1l, <span class="dt">plot.points =</span> <span class="st">&quot;&quot;</span>, <span class="dt">nint =</span> <span class="dv">20</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Note the importance of having a table shaped in “long form”. The density plots are conditioned on <em>crop type</em> which requires that crop type be treated as different values of a same variable (i.e. column <code>Crop</code> in <code>dat1l</code>). The above plot could not be generated had crop types been treated as variables (i.e. columns) as in <code>dat1w</code>.</p>
<p>You can also compare the distributions to a <em>normal</em> distribution (i.e. a Q-Q plot):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">qqmath</span>( ~<span class="st"> </span>Yield |<span class="st"> </span>Crop, dat1l, <span class="dt">plot.points =</span> <span class="st">&quot;&quot;</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">5</span>, <span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Boxplots are another popular way to view the distribution of values. In the following example, we create boxplots of income values as a function of gender (<code>value ~ Gender</code>) and condition this comparison on educational levels (<code>| Level</code>). Since the variable <code>Gender</code> contains three unique values (<code>M</code>, <code>F</code> and <code>All</code>) we will remove all records tied to the whole population (<code>All</code>) by passing a condition, <code>dat2b$Gender != &quot;All&quot;</code> (where <code>!=</code> is interpreted as “not equal to”), to the <code>dat2b</code> index.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bwplot</span>(value ~<span class="st"> </span>Gender |<span class="st"> </span>Level, dat2b[dat2b$Gender !=<span class="st"> &quot;All&quot;</span>,] , <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>The <code>bwplot</code> automatically orders the conditional variable lexicographically which makes little sense here. It would be best to sort the attainment values based on their educational hierarchy. This will require two steps: converting the <code>Level</code> field to a factor using the <code>factor()</code> function, then ordering the elements of the factor using the <code>levels</code> parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2b$Level &lt;-<span class="st"> </span><span class="kw">factor</span>(dat2b$Level, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;All&quot;</span>, <span class="st">&quot;NoHS&quot;</span>, <span class="st">&quot;HS&quot;</span>, <span class="st">&quot;AD&quot;</span>, <span class="st">&quot;BD&quot;</span>, <span class="st">&quot;Grad&quot;</span> )) 

<span class="kw">bwplot</span>(value ~<span class="st"> </span>Gender |<span class="st"> </span>Level, dat2b[dat2b$Gender !=<span class="st"> &quot;All&quot;</span>,] , <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>We may remove the outliers by passing the <code>do.out = FALSE</code> parameter to <code>bwplot</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bwplot</span>(value ~<span class="st"> </span>Gender |<span class="st"> </span>Level, dat2b[dat2b$Gender !=<span class="st"> &quot;All&quot;</span>,] , <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>), <span class="dt">do.out =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>But note that the y-axis range still reflects the outlier values. We will need to explicitly define the y limits using the <code>ylim=</code> parameter.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">bwplot</span>(value ~<span class="st"> </span>Gender |<span class="st"> </span>Level, dat2b[dat2b$Gender !=<span class="st"> &quot;All&quot;</span>,] , <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>), <span class="dt">do.out =</span> <span class="ot">FALSE</span>, <span class="dt">ylim=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">125000</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="visualizing-multivariate-data" class="section level1">
<h1>Visualizing multivariate data</h1>
<div id="basic-line-plots" class="section level2">
<h2>Basic line plots</h2>
<p>The Lattice package allows us to plot several variables on a same plot. For example, we can plot yields vs year for each crop on a same plot:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyplot</span>(Barley +<span class="st"> </span>Buckwheat +<span class="st"> </span>Maize +<span class="st"> </span>Oats +<span class="st"> </span>Rye ~<span class="st"> </span>Year , dat1w, <span class="dt">type =</span> <span class="st">&quot;o&quot;</span>, <span class="dt">pch=</span><span class="dv">20</span>,
        <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">lines =</span> <span class="ot">TRUE</span>, <span class="dt">space =</span> <span class="st">&quot;right&quot;</span>),
        <span class="dt">main =</span> <span class="st">&quot;Grain yield&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Yield&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-23-1.png" width="576" /></p>
<p>Note the use of the wide version (<code>dat1w</code>) of the original <code>dat1</code> dataset. Each crop is treated as its own variable (column) and is added to the plot using the <code>+</code> symbol.</p>
<p>We can also split the plots across a Trellis system by conditioning yields on crop type. But this now requires the use of the long form of the data (i.e. <code>dat1l</code>). The next plot also differs from the previous plot in that we substitute a point-line symbol (<code>type=&quot;o&quot;</code>) with a line symbol only (<code>type=&quot;l&quot;</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyplot</span>(Yield ~<span class="st"> </span>Year |<span class="st"> </span>Crop, dat1l, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>, <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">layout=</span><span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">1</span>),
       <span class="dt">main =</span> <span class="st">&quot;Grain yield&quot;</span>, <span class="dt">ylab =</span> <span class="st">&quot;Yield&quot;</span>, <span class="dt">xlab =</span> <span class="st">&quot;Year&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="scatter-plots" class="section level2">
<h2>Scatter plots</h2>
<p>One key benefit of a Trellis system is its ability to generate bivariate scatter plots conditioned on one or more variables. For example, we may wish to compare incomes between female and male for each county and condition this relationship on educational attainment. This requires that male and female be assigned their own columns (since they are now treated as variables) and that educational attainment be assigned as another column whose values are each levels of educational attainment. We will therefore use <code>dat2c</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dat2c$Level &lt;-<span class="st"> </span><span class="kw">factor</span>(dat2c$Level, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;All&quot;</span>, <span class="st">&quot;NoHS&quot;</span>, <span class="st">&quot;HS&quot;</span>, <span class="st">&quot;AD&quot;</span>, <span class="st">&quot;BD&quot;</span>, <span class="st">&quot;Grad&quot;</span> )) 

<span class="kw">xyplot</span>( M ~<span class="st"> </span>F |<span class="st"> </span>Level, dat2c, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;p&quot;</span>,<span class="st">&quot;g&quot;</span>), <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex=</span><span class="fl">0.6</span>,
        <span class="dt">col.symbol=</span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.1</span>), <span class="dt">aspect=</span><span class="st">&quot;iso&quot;</span>, <span class="dt">abline=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">layout=</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>),
        <span class="dt">xlab=</span><span class="st">&quot;Female income ($)&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Male income($)&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-25-1.png" width="768" /></p>
<p>The <code>xyplot</code> function is passed several parameters. The parameter <code>type = c(&quot;p&quot;,&quot;g&quot;)</code> instructs the function to generate both points, <code>&quot;p&quot;</code>, and a background grid ,<code>&quot;g&quot;</code>. Parameter <code>type</code> can accept many other options, a few are listed in the following table:</p>
<table>
<thead>
<tr class="header">
<th>Option</th>
<th>Adds…</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&quot;p&quot;</code></td>
<td>Points</td>
</tr>
<tr class="even">
<td><code>&quot;l&quot;</code></td>
<td>Lines</td>
</tr>
<tr class="odd">
<td><code>&quot;b&quot;</code></td>
<td>Both points and lines</td>
</tr>
<tr class="even">
<td><code>&quot;o&quot;</code></td>
<td>Both points and lines</td>
</tr>
<tr class="odd">
<td><code>&quot;r&quot;</code></td>
<td>Regression line</td>
</tr>
<tr class="even">
<td><code>&quot;g&quot;</code></td>
<td>Reference grid</td>
</tr>
<tr class="odd">
<td><code>&quot;smooth&quot;</code></td>
<td>LOESS fit</td>
</tr>
<tr class="even">
<td><code>&quot;spline&quot;</code></td>
<td>Cubic spline fit</td>
</tr>
</tbody>
</table>
<p>The parameters <code>pch</code> and <code>cex</code> define the symbol shape and size. The parameter <code>col.symbol</code> defines the point color. The parameter <code>aspect=&quot;iso&quot;</code> sets the aspect ratio in such a way that a unit of measure along x matches that of y, this facilitates income comparison between both sexes since the scales match exactly. The parameter <code>abline=c(0,1)</code> generated a 45° line. If median incomes for male and female were identical in each county, the points would line up along the 45° line. Most points are above the line indicating that male income is greater than female income when aggregated at the county level.</p>
<p>Note that the point distribution seems skewed. We can warp the values in a <code>log()</code> function to help reveal the relationship between male and female income:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyplot</span>( <span class="kw">log</span>(M) ~<span class="st"> </span><span class="kw">log</span>(F) |<span class="st"> </span>Level, dat2c, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;p&quot;</span>,<span class="st">&quot;g&quot;</span>), <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex=</span><span class="fl">0.6</span>,
        <span class="dt">col.symbol=</span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.1</span>), <span class="dt">aspect=</span><span class="st">&quot;iso&quot;</span>, <span class="dt">abline=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">layout=</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">1</span>),
        <span class="dt">xlab=</span><span class="st">&quot;Log of female income ($)&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Log of male income($)&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-26-1.png" width="768" /></p>
<p>We can take this a step further. We could condition the relationship in income between male and female on both educational attainment and states or regions. We won’t condition the scatterplot on states as this would generate 50 x 6 separate plots, so we will condition the plots on region.</p>
<p>Note that since the output will consist of 6 (levels) x 4 (regions) we will need to modify the <code>layout</code> parameter to <code>layout=c(6,4)</code>. We will also stick with the log transformation of income since it seems to do a good job in helping reveal the relationship between both income values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">xyplot</span>( M ~<span class="st"> </span>F |<span class="st"> </span>Level +<span class="st"> </span>Region, dat2c, <span class="dt">type =</span> <span class="kw">c</span>(<span class="st">&quot;p&quot;</span>,<span class="st">&quot;g&quot;</span>), <span class="dt">pch=</span><span class="dv">20</span>, <span class="dt">cex=</span><span class="fl">0.6</span>,
        <span class="dt">col.symbol=</span><span class="kw">rgb</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="fl">0.1</span>), <span class="dt">aspect=</span><span class="st">&quot;iso&quot;</span>, <span class="dt">abline=</span><span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>), <span class="dt">layout=</span><span class="kw">c</span>(<span class="dv">6</span>,<span class="dv">4</span>),
        <span class="dt">xlab=</span><span class="st">&quot;Log of female income ($)&quot;</span>, <span class="dt">ylab=</span><span class="st">&quot;Log of male income($)&quot;</span>)</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-27-1.png" width="768" /></p>
</div>
</div>
<div id="customizing-trellis-plots" class="section level1">
<h1>Customizing trellis plots</h1>
<p>Various elements of a trellis plot can be customized by passing the graphic parameters to the <code>trellis.par.set()</code> function. To get the list of graphic parameters and their values call the <code>trellis.par.get()</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">trellis.par.get</span>()</code></pre></div>
<p>Output for three parameters is shown below:</p>
<pre><code> $ fontsize         :List of 2
  ..$ text  : num 12
  ..$ points: num 8
 $ strip.background :List of 2
  ..$ col  : chr [1:7] &quot;#DFDFDF&quot; &quot;#BFBFBF&quot; &quot;#9F9F9F&quot; &quot;#808080&quot; ...
 $ superpose.polygon:List of 5
  ..$ alpha : num [1:7] 1 1 1 1 1 1 1
  ..$ col   : chr [1:7] &quot;#FBB4AE&quot; &quot;#B3CDE3&quot; &quot;#CCEBC5&quot; &quot;#DECBE4&quot; ...
  ..$ border: chr &quot;black&quot;
  ..$ lty   : num [1:7] 1 1 1 1 1 1 1
  ..$ lwd   : num [1:7] 1 1 1 1 1 1 1</code></pre>
<p>Each parameter consists of a list of elements. For example, the graphic parameter <code>fontsize</code> is made up of two modifiable elements: <code>text</code> and <code>points</code>. The following figure shows a few of the parameters and their associated graphical element:</p>
<div class="figure">
<img src="img/Trellis_anatomy.png" alt="Trellis anatomy" />
<p class="caption">Trellis anatomy</p>
</div>
<p>For example, we will modify the Titanic survival barchart by changing the strip background colors, the bar polygon colors, the text size and color and the label size and color as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define an array of colors. The first array generates unique hues while the </span>
<span class="co"># second generates different shades of grey</span>
col.qual &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#FBB4AE&quot;</span>,<span class="st">&quot;#B3CDE3&quot;</span>,<span class="st">&quot;#CCEBC5&quot;</span>,<span class="st">&quot;#DECBE4&quot;</span>,<span class="st">&quot;#FED9A6&quot;</span>,<span class="st">&quot;#FFFFCC&quot;</span>,<span class="st">&quot;#E5D8BD&quot;</span>)
col.grey &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;#DFDFDF&quot;</span>,<span class="st">&quot;#BFBFBF&quot;</span>,<span class="st">&quot;#9F9F9F&quot;</span>,<span class="st">&quot;#808080&quot;</span>,<span class="st">&quot;#606060&quot;</span>,<span class="st">&quot;#404040&quot;</span>,<span class="st">&quot;#202020&quot;</span>)

<span class="co"># Modify the Trellis parameters</span>
<span class="kw">trellis.par.set</span>(<span class="dt">superpose.polygon =</span> <span class="kw">list</span>(<span class="dt">col =</span> col.qual, <span class="dt">border =</span> <span class="st">&quot;black&quot;</span>))
<span class="kw">trellis.par.set</span>(<span class="dt">strip.background =</span> <span class="kw">list</span>(<span class="dt">col =</span> col.grey))
<span class="kw">trellis.par.set</span>(<span class="dt">add.text =</span> <span class="kw">list</span>(<span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">col=</span><span class="st">&quot;grey20&quot;</span>))
<span class="kw">trellis.par.set</span>(<span class="dt">par.xlab.text =</span> <span class="kw">list</span>(<span class="dt">cex =</span> <span class="fl">0.8</span>, <span class="dt">col=</span><span class="st">&quot;grey20&quot;</span>))

<span class="co"># Now generate the strip charts</span>
<span class="kw">barchart</span>(Class ~<span class="st"> </span>Freq |<span class="st"> </span>Sex +<span class="st"> </span>Age, <span class="dt">data =</span> <span class="kw">as.data.frame</span>(Titanic), 
         <span class="dt">groups =</span> Survived, <span class="dt">stack =</span> <span class="ot">TRUE</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">1</span>),
         <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;Survived&quot;</span>, <span class="dt">columns =</span> <span class="dv">2</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>You’ll note that some of the elements are composed of more than one value such as <code>strip.background</code>’s <code>col</code> element which takes on 7 distinct color values. We did not need to modify all seven since only the first two were used (one for age group and the other for gender). Had we conditioned the plot on a third parameter, a third strip would have been added and the third color in <code>col.grey</code> would have been used. For example:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">barchart</span>(Class ~<span class="st"> </span>Freq |<span class="st"> </span>Sex +<span class="st"> </span>Age +<span class="st"> </span>Survived, <span class="dt">data =</span> <span class="kw">as.data.frame</span>(Titanic), 
         <span class="dt">groups =</span> Survived, <span class="dt">stack =</span> <span class="ot">TRUE</span>, <span class="dt">layout =</span> <span class="kw">c</span>(<span class="dv">4</span>, <span class="dv">2</span>),
         <span class="dt">auto.key =</span> <span class="kw">list</span>(<span class="dt">title =</span> <span class="st">&quot;Survived&quot;</span>, <span class="dt">columns =</span> <span class="dv">2</span>))</code></pre></div>
<p><img src="Week04b_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>Note the third strip (Yes vs No) with the third background color (#9F9F9F) in the color array <code>col.grey</code>.</p>
</div>


<div class="footer">
<hr/>
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>  Manny Gimond (2017)
</br>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
