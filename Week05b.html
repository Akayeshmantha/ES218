<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Comparing data distributions</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-4.5.0/css/font-awesome.min.css" rel="stylesheet" />


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs\style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 02</li>
    <li>
      <a href="Week02a.html">Data types</a>
    </li>
    <li>
      <a href="Week02b.html">Reading and writing data files</a>
    </li>
    <li>
      <a href="Week02c.html">Working with date objects</a>
    </li>
    <li>
      <a href="Week02d.html">Exploring and cleaning dataframes using base functions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 03</li>
    <li>
      <a href="Week03a.html">Manipulating dataframes with dplyr</a>
    </li>
    <li>
      <a href="Week03b.html">Tidying/reshaping tables using tidyr</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 04</li>
    <li>
      <a href="Week03c.html">Joining data tables</a>
    </li>
    <li>
      <a href="Week03d.html">Working with string objects</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 05</li>
    <li>
      <a href="Week04a.html">The base plotting environment</a>
    </li>
    <li>
      <a href="Week04b.html">The lattice plotting environment</a>
    </li>
    <li>
      <a href="Week04c.html">The ggplot plotting environment</a>
    </li>
    <li>
      <a href="Week04d.html">Manipulating colors in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Univariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 06</li>
    <li>
      <a href="Week05a.html">Visualizing univariate data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 07</li>
    <li>
      <a href="Week05b.html">Comparing univariate data distributions</a>
    </li>
    <li>
      <a href="Week06a.html">Theoretical Q-Q plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 08</li>
    <li>
      <a href="Week07a.html">Fits and residuals</a>
    </li>
    <li>
      <a href="Week07b.html">Spread-location plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 09</li>
    <li>
      <a href="Week08a.html">Re-expressing data</a>
    </li>
    <li>
      <a href="Week08b.html">Letter value summaries</a>
    </li>
    <li>
      <a href="Week08c.html">The Two Râ€™s of EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bivariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 10</li>
    <li>
      <a href="Week09a.html">Bivariate analysis</a>
    </li>
    <li>
      <a href="Week09b.html">Resistant lines</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 11</li>
    <li>
      <a href="Week10a.html">The third R of EDA: Residuals</a>
    </li>
    <li>
      <a href="Week10b.html">Detecting discontinuities in the data</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/regression.html">Details of the OLS regression method (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Two-way tables
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 12</li>
    <li>
      <a href="Week11a.html">Median polish/Mean polish</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/ANOVA.html">Details of an ANOVA (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 13</li>
    <li>
      <a href="Week12a.html">Creating maps in R</a>
    </li>
    <li class="dropdown-header">Connecting to relational databases</li>
  </ul>
</li>
<li>
  <a href="Data.html">Datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Comparing data distributions</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#boxplots">Boxplots</a></li>
<li><a href="#the-quantile-quantile-q-q-plot">The quantile-quantile (Q-Q) plot</a><ul>
<li><a href="#manual-construction-of-a-q-q-plot">Manual construction of a q-q plot</a></li>
<li><a href="#using-the-base-qqplot">Using the base <code>qqplot</code></a></li>
</ul></li>
<li><a href="#q-q-plots-are-not-scatter-plots">q-q plots are <em>not</em> scatter plots</a></li>
<li><a href="#what-can-we-learn-from-a-q-q-plot">What can we learn from a q-q plot?</a><ul>
<li><a href="#is-the-relationship-between-tenor-and-bass-additive-or-multiplicative">Is the relationship between tenor and bass additive or multiplicative?</a></li>
</ul></li>
<li><a href="#the-tukey-mean-difference-plot">The Tukey mean-difference plot</a><ul>
<li><a href="#generating-an-m-d-plot-using-ggplot">Generating an m-d plot using <code>ggplot</code></a></li>
</ul></li>
<li><a href="#pairwise-q-q-plots">Pairwise q-q plots</a></li>
</ul>
</div>

<div style="color:#ff7535; background-color:#fff0ee ;   border-left-style: solid">
<p>This tutorial makes use of the following R package(s): <strong><code>dplyr</code></strong>, <strong><code>ggplot2</code></strong>, <strong><code>lattice</code></strong>.</p>
<p>This material can be read in conjunction with <strong>section 2.2</strong> of <strong>Clevelandâ€™s book</strong>.</p>
</div>
<p>Letâ€™s compare singer heights between the <code>Bass 2</code> group and <code>Tenor 1</code> group. We will work off of a subset of Clevelandâ€™s <code>singer</code> dataset which can be found in the <code>lattice</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
<span class="kw">library</span>(ggplot2)

df  &lt;-<span class="st"> </span>lattice::singer
df2 &lt;-<span class="st"> </span><span class="kw">filter</span>(df, voice.part ==<span class="st"> &quot;Bass 2&quot;</span> |<span class="st"> </span>voice.part==<span class="st">&quot;Tenor 1&quot;</span>) %&gt;%<span class="st"> </span>
<span class="st">       </span><span class="kw">mutate</span>(<span class="dt">voice.part =</span> <span class="kw">droplevels</span>(voice.part))</code></pre></div>
<p>Letâ€™s plot both datasets side-by-side. We will jitter the points about their category groups to expose overlapping points.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df2, <span class="kw">aes</span>(<span class="dt">y=</span>height, <span class="dt">x=</span>voice.part, <span class="dt">col=</span>voice.part)) +<span class="st"> </span>
<span class="st">            </span><span class="kw">geom_jitter</span>(<span class="dt">position =</span> <span class="kw">position_jitter</span>(<span class="dt">width =</span> .<span class="dv">1</span>, <span class="dt">height=</span><span class="dv">0</span>))</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-3-1.png" width="384" /></p>
<p>Letâ€™s get the count and median values for both batches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df2 %&gt;%<span class="st"> </span><span class="kw">group_by</span>(voice.part) %&gt;%<span class="st"> </span><span class="kw">summarise</span>(<span class="dt">median =</span> <span class="kw">median</span>(height), <span class="dt">count =</span> <span class="kw">n</span>() )</code></pre></div>
<pre><code># A tibble: 2 Ã— 3
  voice.part median count
      &lt;fctr&gt;  &lt;dbl&gt; &lt;int&gt;
1     Bass 2     72    26
2    Tenor 1     68    21</code></pre>
<p>The basest tend to be slightly taller than the Tenorâ€“this is one way to compare the batches. But how do their distributions differ? We will explore this in the next section.</p>
<div id="boxplots" class="section level2">
<h2>Boxplots</h2>
<p>We can compare the batches using side-by-side boxplots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df2) +<span class="st"> </span><span class="kw">aes</span>(<span class="dt">x=</span>voice.part, <span class="dt">y=</span>height) +<span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-5-1.png" width="288" /></p>
<p>The differences in median values is obvious. Whatâ€™s more, the difference in overall height values is more pronounced with the boxplot than it is with a simple point distributions plot shown earlier.</p>
<p>Are the spreads between the batches comparable? Itâ€™s difficult to tell given that the batches are offset by about four inches. So letâ€™s level the playing field by subtracting the median values from their respective batches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df2.med &lt;-<span class="st"> </span>df2 %&gt;%<span class="st"> </span>
<span class="st">          </span><span class="kw">group_by</span>(voice.part) %&gt;%
<span class="st">          </span><span class="kw">mutate</span>( <span class="dt">NormHeight =</span> height -<span class="st"> </span><span class="kw">median</span>(height)) 

<span class="kw">ggplot</span>(df2.med, <span class="kw">aes</span>(<span class="dt">x=</span>voice.part, <span class="dt">y=</span>NormHeight)) +<span class="st"> </span><span class="kw">geom_boxplot</span>()</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-6-1.png" width="288" /></p>
<p>Leveling the boxplots certainly helps in assessing the difference in spreads. It seems that the <code>Tenor 1</code> group has a slightly wider range of heights than the <code>Bass 2</code> group. About 50% of singers in the <code>Tenor 1</code> group have heights that range five inches whereas the singers in the <code>Bass 2</code> group have heights that range four inches. We also note that the <code>Tenor 1</code> height distribution tends to be skewed towards taller singers whereas the <code>Bass 2</code> height distribution tends to be a little less skewed toward smaller heights.</p>
</div>
<div id="the-quantile-quantile-q-q-plot" class="section level2">
<h2>The quantile-quantile (Q-Q) plot</h2>
<p>A quantile-quantile plot (or Q-Q plot for short) combines two separate quantile plots from different batches of values by pairing the point values by their common <span class="math inline">\(f\)</span>-value.</p>
<div class="figure">
<img src="img/QQ_plot.png" />

</div>
<p>First, we need to compute the <span class="math inline">\(f\)</span>-values for both batches of singer data (<code>Bass 2</code> and <code>Tenor 1</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.qq &lt;-<span class="st"> </span>df2 %&gt;%<span class="st"> </span>
<span class="st">         </span><span class="kw">group_by</span>(voice.part) %&gt;%
<span class="st">         </span><span class="kw">arrange</span>(height) %&gt;%
<span class="st">         </span><span class="kw">mutate</span>( <span class="dt">f.val =</span> (<span class="kw">row_number</span>() -<span class="st"> </span><span class="fl">0.5</span> ) /<span class="st"> </span><span class="kw">n</span>())</code></pre></div>
<p>Now letâ€™s generate quantile plots for both batches.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(df.qq, <span class="kw">aes</span>(<span class="dt">x=</span>f.val, <span class="dt">y =</span> height)) +<span class="st"> </span><span class="kw">geom_line</span>(<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>) +
<span class="st">              </span><span class="kw">geom_point</span>() +<span class="st"> </span><span class="kw">facet_grid</span>( voice.part ~<span class="st"> </span>.) </code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-8-1.png" width="480" /></p>
<p>While the geometric structure of a boxplot lends itself well to side-by-side comparison, the same cannot be said for side-by-side quantile plot comparison hence the need for an amalgamation of these two plots into a single plot called a <strong>quantile-quantile</strong> (<strong>q-q</strong>) plot. If the number of values in both batches are equal, then the plotting process is straightforward: sort both batches (from smallest value to largest value), then pair up the sorted values and plot one batch vs.Â the other batch (see schematic at the beginning of this section)</p>
<p>If the two batches differ in size (as is the case with our example where we have 21 tenors and 26 bassists), we wonâ€™t be able to match sorted values. For example, in the above graph, youâ€™ll note that one of the singerâ€™s height in the <code>Bass 2</code> batch is associated with an <span class="math inline">\(f\)</span>-value of 0.75, however, there are no singer heights associated with an <span class="math inline">\(f\)</span>-value of 0.75 in the <code>Tenor 1</code> batch.</p>
<p>To overcome the problem of batch size mismatch, we limit the number of points in the q-q plot to the number of values associated with the <em>smallest</em> sized batch (21 in our working example). This requires that we find matching singer height values to the set of <span class="math inline">\(f\)</span>-values associated with a batch of 21 values. The following chunk of code computes the 21 <span class="math inline">\(f\)</span>-values. We are rounding the output to two decimal places for presentation only.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Generate and index</span>
i  &lt;-<span class="st"> </span><span class="dv">1</span>:<span class="dv">21</span>
<span class="co"># Compute the f-values</span>
fi &lt;-<span class="st"> </span>(i -<span class="st"> </span><span class="fl">0.5</span>) /<span class="st"> </span><span class="dv">21</span>
<span class="co"># view rounded values</span>
<span class="kw">round</span>(fi,<span class="dv">2</span>)</code></pre></div>
<pre><code> [1] 0.02 0.07 0.12 0.17 0.21 0.26 0.31 0.36 0.40 0.45 0.50 0.55 0.60 0.64 0.69 0.74 0.79 0.83 0.88 0.93 0.98</code></pre>
<p>To find the matching singer height values in <code>Bass2</code>, we need to interpolate the original height values. In practice, a linear interpolation is sought unless theory justifies otherwise.</p>
<p>We will explore two methods: a <strong>manual</strong> approach to constructing a q-q plot and the <code>qqplot()</code> function approach. <strong>Note that both methods can produce slightly different q-q plots</strong>â€“this is to be expected since they may adopt different quantile algorithms.</p>
<p>In all cases, we will add a 45Â° line (i.e.Â the <code>Bass 1</code> <span class="math inline">\(=\)</span> <code>Tenor 1</code> line) that shows where we would expect the points to be plotted if both distributions were identical.</p>
<div id="manual-construction-of-a-q-q-plot" class="section level3">
<h3>Manual construction of a q-q plot</h3>
<p>To find a value in the larger dataset (i.e. <code>Bass 2</code>) that matches the 21 quantiles of the smaller dataset, <code>Tenor 1</code>, we can use the <code>approx()</code> function.</p>
<p>First, we will extract all values associated with <code>Bass 2</code> from the dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df.bass  &lt;-<span class="st"> </span>df.qq %&gt;%<span class="st">  </span><span class="kw">filter</span>( voice.part ==<span class="st"> &quot;Bass 2&quot;</span>)
df.tenor &lt;-<span class="st"> </span>df.qq %&gt;%<span class="st">  </span><span class="kw">filter</span>( voice.part ==<span class="st"> &quot;Tenor 1&quot;</span>)</code></pre></div>
<p>Next, we will interpolate a new set of height values for <code>Bass 2</code> that match the 21 quantile values in <code>fi</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b.hgt.interp &lt;-<span class="st"> </span><span class="kw">approx</span>(df.bass$f.val, df.bass$height, fi)</code></pre></div>
<p>The output generates two columns: the 21 quantiles, <code>fi</code>, and the 21 <code>Bass 2</code> interpolated height values. Note that we could have substituted <code>fi</code> with <code>df.tenor$f.val</code>. The approach shown here is used to reinforce the idea that we are interpolating height values based on a <em>new</em> set of f-values.</p>
<p>Finally, we will combine the interpolated <code>Bass 2</code> values (which is already in an ascending order) with <strong>sorted</strong> heights for the <code>Tenor 1</code> singers (these were sorted in <code>df.qq</code>). Then, we will plot the paired values using <code>ggplot</code>. We will also add the 45Â° line to facilitate comparison.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s.qq &lt;-<span class="st"> </span>df.tenor %&gt;%<span class="st"> </span><span class="kw">mutate</span>(<span class="st">`</span><span class="dt">Bass 2</span><span class="st">`</span>  =<span class="st"> </span>b.hgt.interp$y) %&gt;%<span class="st"> </span>
<span class="st">                     </span><span class="kw">rename</span>(<span class="st">`</span><span class="dt">Tenor 1</span><span class="st">`</span> =<span class="st"> </span>height) 

<span class="kw">ggplot</span>(s.qq, <span class="kw">aes</span>( <span class="dt">x=</span> <span class="st">`</span><span class="dt">Tenor 1</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Bass 2</span><span class="st">`</span>)) +<span class="st"> </span><span class="kw">geom_point</span>() +<span class="st"> </span><span class="kw">geom_abline</span>( <span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">slope=</span><span class="dv">1</span>)</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-12-1.png" width="288" /></p>
<p>Note that the range of values for both axes may not match; this may influence our visual assessment of the differences. To remedy this, we can force a fixed aspect ratio between both axes.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Get the range of both datasets</span>
xylim &lt;-<span class="st"> </span><span class="kw">range</span>( <span class="kw">c</span>(s.qq$<span class="st">&quot;Bass&quot;</span>, s.qq$<span class="st">`</span><span class="dt">Tenor 1</span><span class="st">`</span>) )

<span class="co"># Add a 5% buffer to the xy limits</span>
<span class="co"># (This avoids having the points plotted on the edge of the plot)</span>
xylim &lt;-<span class="st"> </span>xylim +<span class="st"> </span><span class="kw">c</span>(-<span class="fl">0.05</span> *<span class="st"> </span><span class="kw">diff</span>(xylim), +<span class="st"> </span><span class="fl">0.05</span> *<span class="st"> </span><span class="kw">diff</span>(xylim))

<span class="kw">ggplot</span>(s.qq, <span class="kw">aes</span>( <span class="dt">x=</span> <span class="st">`</span><span class="dt">Tenor 1</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Bass 2</span><span class="st">`</span>)) +<span class="st"> </span>
<span class="st">             </span><span class="kw">geom_point</span>() +<span class="st"> </span>
<span class="st">             </span><span class="kw">geom_abline</span>( <span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">slope=</span><span class="dv">1</span>) +
<span class="st">             </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="dv">1</span>, <span class="dt">xlim=</span>xylim, <span class="dt">ylim =</span> xylim)</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-13-1.png" width="288" /></p>
</div>
<div id="using-the-base-qqplot" class="section level3">
<h3>Using the base <code>qqplot</code></h3>
<p>This approach is quicker and requires fewer lines of code, but it does not afford the insight into the inner workings of a q-q plot as does the manual approach from the previous section.</p>
<p><code>qqplot</code> is a base package that will generate a q-q plot using the base plotting environment. It requires that the two batches be loaded as separate vector objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Tenor &lt;-<span class="st"> </span><span class="kw">filter</span>(df, voice.part ==<span class="st"> &quot;Tenor 1&quot;</span>)
Bass  &lt;-<span class="st"> </span><span class="kw">filter</span>(df, voice.part ==<span class="st"> &quot;Bass 2&quot;</span>)
<span class="kw">qqplot</span>(<span class="dt">x=</span>Tenor$height, <span class="dt">y=</span>Bass$height, <span class="dt">asp=</span><span class="dv">1</span>)
<span class="kw">abline</span>( <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>))</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-14-1.png" width="288" /></p>
<p><code>qqplot</code> offers the option to output the q-q plot values (including the interpolated values) as a <strong>list</strong> by setting the parameter <code>plot.it=FALSE</code>. We then need to convert this list object to a dataframe using <code>as.data.frame</code>. The output can then be used in a call to <code>ggplot</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">qq.out &lt;-<span class="st"> </span><span class="kw">qqplot</span>(<span class="dt">x=</span>Tenor$height, <span class="dt">y=</span>Bass$height, <span class="dt">plot.it=</span><span class="ot">FALSE</span>)
qq.out &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(qq.out)

xylim &lt;-<span class="st"> </span><span class="kw">range</span>( <span class="kw">c</span>(qq.out$x, qq.out$y) )
xylim &lt;-<span class="st"> </span>xylim +<span class="st"> </span><span class="kw">c</span>(-<span class="fl">0.05</span> *<span class="st"> </span><span class="kw">diff</span>(xylim), +<span class="st"> </span><span class="fl">0.05</span> *<span class="st"> </span><span class="kw">diff</span>(xylim))
<span class="kw">ggplot</span>(qq.out, <span class="kw">aes</span>( <span class="dt">x=</span> x, <span class="dt">y =</span> y)) +<span class="st"> </span>
<span class="st">               </span><span class="kw">geom_point</span>() +<span class="st"> </span>
<span class="st">               </span><span class="kw">geom_abline</span>( <span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">slope=</span><span class="dv">1</span>) +
<span class="st">               </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="dv">1</span>, <span class="dt">xlim=</span>xylim, <span class="dt">ylim =</span> xylim) +
<span class="st">               </span><span class="kw">xlab</span>(<span class="st">&quot;Tenor&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Bass&quot;</span>)</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-15-1.png" width="288" /></p>
</div>
</div>
<div id="q-q-plots-are-not-scatter-plots" class="section level2">
<h2>q-q plots are <em>not</em> scatter plots</h2>
<p>Itâ€™s important to note the difference between a quantile-quantile plot and a <a href="https://en.wikipedia.org/wiki/Scatter_plot">scatter plot</a>. The latter is used when the pairing of values between variables is explicit (for example average male and female incomes for a specific US county). The q-q plot does not assume any pairing of observations (e.g.Â the height measurement for a singer in <code>Bass 2</code> is not linked to a height measurement in <code>Tenor 2</code>). This is made more evident with our working example which has unequal number of singers in both groups being compared since such a dataset could not be plotted using a scatter plot.</p>
</div>
<div id="what-can-we-learn-from-a-q-q-plot" class="section level2">
<h2>What can we learn from a q-q plot?</h2>
<p>A valuable by-product of an empirical q-q plot is the mathematical relationship between the batches of values. If the distributions are identical (i.e.Â all the points of a q-q plot fall on the 45Â° line) then we could characterize the relationship as <code>batch1 = batch2</code>. If the points follow a pattern mimicking a line parallel to the 45Â° line as in the following plot,</p>
<p><img src="Week05b_files/figure-html/unnamed-chunk-16-1.png" width="192" /></p>
<p>then we say that there is an <strong>additive shift</strong> between <code>batch1</code> and <code>batch2</code>. The shift can usually be eyeballed from the plot. In this example, the shift is around 2 or <code>batch2 = 2 * batch1</code>.</p>
<p>When the points follow a line at an angle to the 45Â° line as in</p>
<p><img src="Week05b_files/figure-html/unnamed-chunk-17-1.png" width="192" /></p>
<p>then we say that there is a <strong>multiplicative shift</strong> between the batches. The multiplier can be a bit difficult to glean graphically so trial and error may be the best approach whereby we multiply one of the batches by the inverse of the suspected relationship. For example, if we believe that <code>batch2</code> is 1.5 times greater than <code>batch1</code>, we divide the former by 1.5 then plot the result to see if the points line up.</p>
<p><img src="Week05b_files/figure-html/unnamed-chunk-18-1.png" width="192" /></p>
<p>In many cases, you might encounter a relationship that is both additive <em>and</em> multiplicative in which case you should first resolve the multiplicative part of the pattern until the points are close to parallel to the 45Â° line, then resolve the additive portion. For example, the following plot</p>
<p><img src="Week05b_files/figure-html/unnamed-chunk-19-1.png" width="192" /></p>
<p>can be decomposed into its multiplicative component (divide by ~ 1.5),</p>
<p><img src="Week05b_files/figure-html/unnamed-chunk-20-1.png" width="192" /></p>
<p>then by its additive component (subtract by ~ 3.5),</p>
<p><img src="Week05b_files/figure-html/unnamed-chunk-21-1.png" width="192" /></p>
<p>to get the approximate relationship of <code>batch2 = batch1 * 1.5 + 3.5</code>.</p>
<div id="is-the-relationship-between-tenor-and-bass-additive-or-multiplicative" class="section level3">
<h3>Is the relationship between tenor and bass additive or multiplicative?</h3>
<p>Turning back to our voice part dataset, an additive shift is apparent, but a multiplicative shift not as much. To check, weâ€™ll subtract the <code>Bass 2</code> value by about 2.5.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">ggplot</span>(s.qq, <span class="kw">aes</span>( <span class="dt">x=</span> <span class="st">`</span><span class="dt">Tenor 1</span><span class="st">`</span>, <span class="dt">y =</span> <span class="st">`</span><span class="dt">Bass 2</span><span class="st">`</span>  -<span class="st"> </span><span class="fl">2.5</span>)) +<span class="st"> </span>
<span class="st">             </span><span class="kw">geom_point</span>() +<span class="st"> </span>
<span class="st">             </span><span class="kw">geom_abline</span>( <span class="dt">intercept=</span><span class="dv">0</span>, <span class="dt">slope=</span><span class="dv">1</span>) +
<span class="st">             </span><span class="kw">coord_fixed</span>(<span class="dt">ratio =</span> <span class="dv">1</span>, <span class="dt">xlim=</span>xylim, <span class="dt">ylim =</span> xylim) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Bass 2 - 2.5&quot;</span>)</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-22-1.png" width="288" /></p>
<p>The bulk of the data appears to follow an additive shift except for one or two outliers at the upper end of the distribution. These outliers should not mislead us into assuming that a multiplicative offset is warranted here.</p>
</div>
</div>
<div id="the-tukey-mean-difference-plot" class="section level2">
<h2>The Tukey mean-difference plot</h2>
<p>Cleveland notes on page 23 that our eyes are better suited at judging deviations from a horizontal line than from a 45Â° line. All that is required is to subtract the y-value, <code>Bass2</code>, from the x-value, <code>Tenor 2</code>, then compare the difference to the mean of the two values:</p>
<p><span class="math display">\[
Y = Bass- Tenor 
\]</span> <span class="math display">\[
X = \frac{Bass + Tenor}{2}
\]</span></p>
<p>This forces the 45Â° line in the previous q-q plots to a 0Â° slope. The final plot is a <strong>Tukey mean-difference</strong> plot or <strong>m-d</strong> for short.</p>
<div id="generating-an-m-d-plot-using-ggplot" class="section level3">
<h3>Generating an m-d plot using <code>ggplot</code></h3>
<p>We continue with the <code>qq.out</code> dataset generated from the <code>qqplot</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">md.y  &lt;-<span class="st"> </span>(qq.out$y -<span class="st"> </span>qq.out$x) 
md.x  &lt;-<span class="st"> </span>(qq.out$y +<span class="st"> </span>qq.out$x) *<span class="st"> </span><span class="fl">0.5</span>
df.md &lt;-<span class="st"> </span><span class="kw">data.frame</span>(md.x, md.y)

<span class="kw">ggplot</span>(df.md,  <span class="kw">aes</span>(<span class="dt">x =</span> md.x, <span class="dt">y =</span> md.y)) +<span class="st"> </span><span class="kw">geom_point</span>() +<span class="st"> </span><span class="kw">geom_abline</span>( <span class="dt">slope=</span><span class="dv">0</span> ) +
<span class="st">               </span><span class="kw">xlab</span>(<span class="st">&quot;Mean height (in)&quot;</span>) +<span class="st"> </span><span class="kw">ylab</span>(<span class="st">&quot;Difference in height (in)&quot;</span>)</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-23-1.png" width="288" /></p>
<p>The units on both axes are in inches. Itâ€™s clear from this plot that differences in heights are pretty much consistent across the quantiles with an additive shift of about 2.5 inches, except near the higher quantiles for a few lone points.</p>
</div>
</div>
<div id="pairwise-q-q-plots" class="section level2">
<h2>Pairwise q-q plots</h2>
<p>A <strong>pairwise q-q plot</strong> allows one to view all combinations of batch pairs. This requires that we first find the smallest batch of height values, then interpolate all other batch values to match the smallest batch quantiles. Note that the pairwise plot is symmetrical about the diagonal. Here, weâ€™ll make use of the <code>lattice</code> package to generate the pairwise q-q plots.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(lattice)
<span class="co"># Find smallest batch</span>
f.rng &lt;-<span class="st"> </span><span class="kw">min</span>(<span class="kw">tapply</span>(singer$height, singer$voice.part, length))

<span class="co"># Define quantile function</span>
fun1  &lt;-<span class="st"> </span>function(x,f.rng) {<span class="kw">approx</span>(<span class="dv">1</span>:<span class="kw">length</span>(x), <span class="kw">sort</span>(x), <span class="dt">n =</span> f.rng )$y}

<span class="co"># Compute quantiles for all factors</span>
t1    &lt;-<span class="st"> </span><span class="kw">aggregate</span>(singer$height ~<span class="st"> </span>singer$voice.part, <span class="dt">FUN=</span>fun1, <span class="dt">f.rng=</span>f.rng )

<span class="co"># Flip table and name columns</span>
t2    &lt;-<span class="st"> </span><span class="kw">as.data.frame</span>(<span class="kw">t</span>(t1[,-<span class="dv">1</span>]))
<span class="kw">names</span>(t2) &lt;-<span class="st"> </span>t1[,<span class="dv">1</span>]

<span class="co"># Label columns of qmat using names of voice parts.</span>
<span class="kw">splom</span>(~t2,  <span class="dt">axis.text.cex=</span><span class="fl">0.6</span>, <span class="dt">pch =</span> <span class="dv">20</span>,
      <span class="dt">varname.cex=</span><span class="fl">0.8</span>,
      <span class="dt">pscales=</span><span class="dv">3</span>,
      <span class="dt">xlab=</span><span class="st">&quot;Heights (inches)&quot;</span>,
      <span class="dt">prepanel.limits =</span> function(x) (<span class="kw">range</span>(t2)), <span class="co"># force all axes the same</span>
      <span class="dt">panel =</span> function(x,y,...){
        <span class="kw">panel.grid</span>()
        <span class="kw">panel.splom</span>(x,y,...)
        <span class="kw">panel.abline</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dt">col=</span><span class="st">&quot;grey&quot;</span>)
      })</code></pre></div>
<p><img src="Week05b_files/figure-html/unnamed-chunk-24-1.png" width="576" /></p>
</div>


<div class="footer">
<hr/>
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>  Manny Gimond (2017)
</br>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
