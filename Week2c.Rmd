---
title: "Week2: Working with Dates"
output:
  html_document:
    toc: yes
    toc_depth: 3
  word_document: default
---

Date values can be represented in tables as numbers or characters. But to work properly with date representation, it must be converted to an R date object. R provides many facilities to convert and manipulate dates and times, but a package called `lubridate` makes working with dates/times much easier. The following subsections make use of the `lubridate` package.

# Creating date/time objects

You can convert many representations of date and time to date objects. For example, let's create a vector of dates represented as month/day/year character strings,

```{r}
x <- c("06/23/2013", "06/30/2013", "07/12/2014")
```

At this point, R treats the vector `x` as characters. To force R to interpret these as dates, use `lubridate`'s `mdy` function. `mdy` will convert date strings where the date elements are ordered as month, day and year (for other date element arrangements, see the table shown below).

```{r}
library(lubridate)
x.date <- mdy(x)
x.date
```

If you need to specify the time zone, add the parameter `tz=`.

```{r}
x.date <- mdy(x, tz="EST")
x.date
```

The function `mdy` can read in date formats that use different delimiters so that `mdy("06/23/2013")`, `mdy("06-23-2013")` and `mdy("06.23.2013")` are parsed exactly the same. Different `lubridate` functions are available for different date formats. A few are listed below.

Functions  |  Date Format
-----------|--------------
`dmy()`    | day/month/year
`ymd()`    | year/month/day
`ydm()`    | year/day/month

If your data contains both date and time in a "month/day/year hour:minutes:seconds" format use the `mdy_hms` function.

```{r}
x <- c("06/23/2013 03:45:23", "07/30/2013 14:23:00", "08/12/2014 18:01:59")
x.date <- mdy_hms(x, tz="EST")
x.date
```

The characters `_h`, `_hm` or `_hms` can be appended to any of the date functions to accommodate other date/time formats such as `dmy_h` or `ymd_hms`.

# Extracting date information

If you want to get the day of the week from a date vector, use the `wday` function. 

```{r}
wday(x.date)
```

If you want the day of the week displayed as its three letter designation, add the `label=TRUE` parameter.

```{r}
wday(x.date, label = TRUE)
```

You'll note that this last call not only returns the day of the week (`r as.character(wday(x.date, label = TRUE))`) but it also returns `Levels` information indicating that the returned values are  treated as factors and not plain characters or dates.

The following table lists functions that extract different elements of a date object.


Functions  |  Extracted element
-----------|--------------
`hour()`   | Hour of the day
`minute()` | Minute of the hour
`day()`    | Day of the month
`yday()`   | Day of the year
`month()`  | Month of the year
`year()`   | Year
`tz()`     | Time zone

# Operating on dates

You can apply certain operations to dates as you would to numbers. For example, to list the number of days between the first and third elements of the vector `x.date` type the following:

```{r}
(x.date[3] - x.date[1]) / edays()
```

To get the number of weeks between both dates:
```{r}
(x.date[3] - x.date[1]) / eweeks()
```

Likewise, you can get the number of minutes between dates by dividing by `eminutes()` and the number of years by dividing by `eyears()`. 

# Formatting date objects

You can create a character vector from a date object. For example, to convert the date object `x.date` to a "Month_name Year" format, type the following:

```{r}
as.character(x.date, format="%B %Y")
```

The `format=` parameter accepts many different date/time format codes listed in the following table (note the case!).

Format codes  |  Description             | Example
--------------|--------------------------|------------------------------------------
`%a`          | Abbreviated weekday name | `r as.character(x.date, format="%a")`
`%A`          | Full weekday name        | `r as.character(x.date, format="%A")`
`%m`          | Month as decimal number  | `r as.character(x.date, format="%m")`
`%b`          | Abbreviated month name   | `r as.character(x.date, format="%b")`
`%B`          | Full month name          | `r as.character(x.date, format="%B")`
`%c`          | Date and time, locale-specific |  `r as.character(x.date, format="%c")`
`%d`          | Day of the month as decimal number | `r as.character(x.date, format="%d")`
`%H`          | Hours as decimal number (00 to 23) | `r as.character(x.date, format="%H")`
`%I`          | Hours as decimal number (01 to 12) | `r as.character(x.date, format="%I")`
`%p`          | AM/PM indicator in the locale | `r as.character(x.date, format="%p")`
`%j`          | Day of year as decimal number | `r as.character(x.date, format="%j")`
`%M`          | Minute as decimal number (00 to 59) | `r as.character(x.date, format="%M")`
`%S`          | Second as decimal number | `r as.character(x.date, format="%S")`
`%U`          | Week of the year starting on the first Sunday | `r as.character(x.date, format="%U")`
`%W`          | Week of the year starting on the first Monday | `r as.character(x.date, format="%W")`
`%w`          | Weekday as decimal number (Sunday = 0) | `r as.character(x.date, format="%w")`
`%x`          | Date (locale-specific)  | `r as.character(x.date, format="%x")`
`%X`          | Time (locale-specific)  | `r as.character(x.date, format="%X")`
`%Y`          | 4-digit year            | `r as.character(x.date, format="%Y")`
`%y`          | 2-digit year            | `r as.character(x.date, format="%y")`
`%Z`          | Abbreviated time zone   | `r as.character(x.date, format="%Z")`
`%z`          | Time zone               | `r as.character(x.date, format="%z")`
