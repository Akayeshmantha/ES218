<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Mapping variables</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-39623718-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-39623718-2');
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #0000ff; } /* Keyword */
code > span.ch { color: #008080; } /* Char */
code > span.st { color: #008080; } /* String */
code > span.co { color: #008000; } /* Comment */
code > span.ot { color: #ff4000; } /* Other */
code > span.al { color: #ff0000; } /* Alert */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #008000; font-weight: bold; } /* Warning */
code > span.cn { } /* Constant */
code > span.sc { color: #008080; } /* SpecialChar */
code > span.vs { color: #008080; } /* VerbatimString */
code > span.ss { color: #008080; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { } /* Variable */
code > span.cf { color: #0000ff; } /* ControlFlow */
code > span.op { } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #ff4000; } /* Preprocessor */
code > span.do { color: #008000; } /* Documentation */
code > span.an { color: #008000; } /* Annotation */
code > span.cv { color: #008000; } /* CommentVar */
code > span.at { } /* Attribute */
code > span.in { color: #008000; } /* Information */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>

<link rel="stylesheet" href="libs\style.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<div class="container-fluid main-container">

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->



<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
    
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Data Manipulation
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 02</li>
    <li>
      <a href="Week02a.html">Data types</a>
    </li>
    <li>
      <a href="Week02b.html">Reading and writing data files</a>
    </li>
    <li>
      <a href="Week02c.html">Working with date objects</a>
    </li>
    <li>
      <a href="Week02d.html">Exploring and cleaning dataframes using base functions</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 03</li>
    <li>
      <a href="Week03a.html">Manipulating dataframes with dplyr</a>
    </li>
    <li>
      <a href="Week03d.html">Working with string objects</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 04</li>
    <li>
      <a href="Week03ab_groupby.html">Grouping and summarizing tables</a>
    </li>
    <li>
      <a href="Week03b.html">Tidying/reshaping tables using tidyr</a>
    </li>
    <li>
      <a href="Week03c.html">Joining data tables</a>
    </li>
    <li>
      <a href="Week03ab_examples.html">Example of data manipulation workflows</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Plots
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 05</li>
    <li>
      <a href="Week04a.html">The base plotting environment</a>
    </li>
    <li>
      <a href="Week04b.html">The lattice plotting environment</a>
    </li>
    <li>
      <a href="Week04c.html">The ggplot plotting environment</a>
    </li>
    <li>
      <a href="Week04d.html">Manipulating colors in R</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Univariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 06</li>
    <li>
      <a href="Week05a.html">Visualizing univariate data</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 07</li>
    <li>
      <a href="Week05b.html">Comparing univariate data distributions</a>
    </li>
    <li>
      <a href="Week06a.html">Theoretical Q-Q plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 08</li>
    <li>
      <a href="Week07a.html">Fits and residuals</a>
    </li>
    <li>
      <a href="Week07b.html">Spread-location plot</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 09</li>
    <li>
      <a href="Week08a.html">Re-expressing data</a>
    </li>
    <li>
      <a href="Week08b.html">Letter value summaries</a>
    </li>
    <li>
      <a href="Week08c.html">The Two R’s of EDA</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Bivariate
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 10</li>
    <li>
      <a href="Week09a.html">Bivariate analysis</a>
    </li>
    <li>
      <a href="Week09b.html">Resistant lines</a>
    </li>
    <li class="divider"></li>
    <li class="dropdown-header">Week 11</li>
    <li>
      <a href="Week10a.html">The third R of EDA: Residuals</a>
    </li>
    <li>
      <a href="Week10b.html">Detecting discontinuities in the data</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/regression.html">Details of the OLS regression method (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Two-way tables
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li class="dropdown-header">Week 12</li>
    <li>
      <a href="Week11a.html">Median polish/Mean polish</a>
    </li>
    <li>
      <a href="http://mgimond.github.io/Stats-in-R/ANOVA.html">Details of an ANOVA (optional reading)</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Misc
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Misc01.html">R markdown documents</a>
    </li>
    <li class="dropdown-header">Week 13</li>
    <li>
      <a href="Week12a.html">Creating maps in R</a>
    </li>
    <li class="dropdown-header">Connecting to relational databases</li>
  </ul>
</li>
<li>
  <a href="Data.html">Datasets</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->
<link href="https://fonts.googleapis.com/css?family=Open+Sans%7CSource+Code+Pro" rel="stylesheet">

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Mapping variables</h1>

</div>


<p>Variables can be mapped in R using packages such as <code>ggplot2</code> and <code>tmap</code>. The focus of this tutorial will be on mapping polygon (aka areal) data. For more information on mapping spatial data (both vector and raster) visit the <a href="https://mgimond.github.io/Spatial/mapping-data-in-r.html">GIS and Spatial Analysis pages</a>.</p>
<div id="ggplot2-and-tmap" class="section level1">
<h1><code>ggplot2</code> and <code>tmap</code></h1>
<p>There are at least two mapping solutions in R: <code>ggplot2</code> and <code>tmap</code>. The bulk of this tutorial will make use of <code>tmap</code> but a brief example of <code>ggplot2</code>’s mapping capabilities will be presented next.</p>
<div id="generating-a-basic-map-in-ggplot2" class="section level2">
<h2>Generating a basic map in <code>ggplot2</code></h2>
<p>Mapping values requires two datasets: the values to be mapped and the spatial boundaries of the areas being mapped. The <code>maps</code> package offers R-ready maps for US states/counties and administrative boundaries for other countries such as Canada, France and Italy.</p>
<p>In the following example we will use <code>ggplot2</code> to draw the US counties map. We will also color the counties based on the state they are located in. The state name column is labeled <code>region</code> and the county name column is labeled <code>subregion</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ggplot2)
<span class="kw">library</span>(maps)
<span class="kw">library</span>(sf)

<span class="co"># Load the county data from the maps package</span>
cnty &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(<span class="kw">map</span>(<span class="st">&quot;county&quot;</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>, <span class="dt">fill =</span> <span class="ot">TRUE</span>))

<span class="co"># Plot the counties</span>
<span class="kw">ggplot</span>(cnty) <span class="op">+</span><span class="st">  </span><span class="kw">geom_sf</span>() </code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-2-1.png" width="528" /></p>
<p>The default ggplot grey theme works well for non-spatial data, but it may not be that suitable for spatial data. We can remove it with the <code>theme_bw()</code> option.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Plot the counties</span>
<span class="kw">ggplot</span>(cnty) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-3-1.png" width="528" /></p>
<p>You can modify the map projection by passing the projection type to the <code>coord_sf</code> function. The projection is defined using <a href="https://proj4.org/apps/proj.html">PROJ4 formatted string</a>. For example, to project the continental US into a Lambert equal area projection, type:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Define the projection using PROJ4 syntax</span>
ea &lt;-<span class="st"> &quot;+proj=laea +lat_0=45 +lon_0=-100 +x_0=0 +y_0=0 +a=6370997 +b=6370997 +units=m +no_defs&quot;</span>

<span class="kw">ggplot</span>(cnty) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">geom_sf</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs=</span>ea) </code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-4-1.png" width="528" /></p>
<p>To learn more on spatial projections in R <a href="https://mgimond.github.io/Spatial/coordinate-systems-in-r.html">click here</a>.</p>
</div>
<div id="generating-a-basic-map-in-tmap" class="section level2">
<h2>Generating a basic map in <code>tmap</code></h2>
<p>While <code>ggplot2</code> can handle basic mapping operations, it does not offer the ease and flexibility of the <code>tmap</code> package. Much like <code>ggplot2</code>, <code>tmap</code> adopts the same layering strategy. For example, to construct the above plot we first specify the layer to plot via the call to <code>tm_shape</code>, then the geometry to symbolize the spatial feature (<code>tm_polygons()</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(tmap)

<span class="kw">tm_shape</span>(cnty) <span class="op">+</span><span class="st">  </span><span class="kw">tm_polygons</span>()</code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-5-1.png" width="528" /></p>
<p>To change the projection, pass the PROJ4 string to the <code>projection</code> parameter. To add a lat/long graticule, use the <code>tm_grid()</code> function. As with <code>ggplot2</code>, map elements are layered in the order in which they are called.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tm_shape</span>(cnty, <span class="dt">projection =</span> ea) <span class="op">+</span><span class="st"> </span>
<span class="st">  </span><span class="kw">tm_grid</span>(<span class="dt">projection =</span> <span class="st">&quot;+proj=longlat&quot;</span>, <span class="dt">col =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">labels.inside.frame =</span> <span class="ot">FALSE</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_polygons</span>() <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_layout</span>(<span class="dt">outer.margins =</span> <span class="kw">c</span>(.<span class="dv">1</span>,.<span class="dv">1</span>,.<span class="dv">1</span>,.<span class="dv">1</span>))</code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-6-1.png" width="528" /></p>
<p>While grids are helpful in locating features on a map, they are not always necessary and can take away from the intended visual hierarchy. In what follows, we will be focusing on choropleth maps whereby the intended focus will be on the relative distribution of a variable across polygon units. We’ll therefore refrain from adding a grid to the map.</p>
<p><a href="https://mgimond.github.io/Spatial/mapping-data-in-r.html">Click here</a> to explore additional mapping options with <code>tmap</code>.</p>
</div>
</div>
<div id="joing-tables-to-spatial-objects" class="section level1">
<h1>Joing tables to spatial objects</h1>
<p>In the examples that follow, you will learn how to join census income data to a spatial object in one of two ways: by state and county name, and by FIPS (Federal Information Processing Standards) id.</p>
<div id="joining-income-table-to-the-map-by-county-and-state-names" class="section level2">
<h2>Joining income table to the map by county and state names</h2>
<p>The next step is to <em>join</em> a dataset to the counties map. We will use the income-by-gender-education dataset used earlier in the course and limit the data to <em>median income per person</em> (<code>B20004001</code> column).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)
df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://mgimond.github.io/ES218/Data/Income_education.csv&quot;</span>)
df1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(<span class="dt">subregion =</span> County, <span class="dt">region =</span> State, B20004001 )</code></pre></div>
<p>Next, we need to join the census data to the county map using <em>two</em> columns: state name and county name (or <code>region</code> and <code>subregion</code> columns). Let’s compare the two dataframes by viewing the first few rows of each.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(cnty)</code></pre></div>
<pre><code>Simple feature collection with 6 features and 1 field
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: -88.01778 ymin: 30.24071 xmax: -85.06131 ymax: 34.2686
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
                        geometry              ID
1 MULTIPOLYGON (((-86.50517 3... alabama,autauga
2 MULTIPOLYGON (((-87.93757 3... alabama,baldwin
3 MULTIPOLYGON (((-85.42801 3... alabama,barbour
4 MULTIPOLYGON (((-87.02083 3...    alabama,bibb
5 MULTIPOLYGON (((-86.9578 33...  alabama,blount
6 MULTIPOLYGON (((-85.66866 3... alabama,bullock</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(df1)</code></pre></div>
<pre><code>  subregion region B20004001
1   Autauga     al     35881
2   Baldwin     al     31439
3   Barbour     al     25201
4      Bibb     al     29016
5    Blount     al     32035
6   Bullock     al     26408</code></pre>
<p>We note two problems. First, the <code>cnty</code> object encodes states using their full name and not their two letter abbreviation. Second, the county names in <code>cnty</code> are in <em>all</em> lower case. Before attempting to join the dataframes, we must first fix these discrepancies. We will choose to modify <code>df</code> so that its state and county names match those in the <code>cnty</code> (map) dataframe.</p>
<p>We will first create a state name/abbreviation look-up table using the built-in <code>state.name</code> and <code>state.abb</code> objects. Note that using these pre-existing objects will require that we add the District of Columbia to the table since it’s not present in either data objects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">st &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">region=</span><span class="kw">tolower</span>(state.name), <span class="dt">State =</span> <span class="kw">tolower</span>(state.abb)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">      </span><span class="kw">bind_rows</span>( <span class="kw">data.frame</span>(<span class="dt">region=</span><span class="st">&quot;district of columbia&quot;</span>, <span class="dt">State=</span><span class="st">&quot;dc&quot;</span>) ) </code></pre></div>
<p>Next, we join the <code>st</code> look-up table to <code>df</code> then make the additional changes needed to join the census data to the counties map. Note that we are overwriting the earlier instance of <code>df1</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(st, <span class="dt">by=</span><span class="st">&quot;State&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ID =</span> <span class="kw">paste</span>(region,<span class="kw">tolower</span>(County), <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>))  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(ID, B20004001 )</code></pre></div>
<p>We can now join <code>df1</code> to <code>cnty</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnty.df1 &lt;-<span class="st"> </span><span class="kw">inner_join</span>(cnty, df1, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span> )</code></pre></div>
<p>Now let’s map the income distribution.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tm_shape</span>(cnty.df1) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;B20004001&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Greens&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_legend</span>(<span class="dt">outside =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-12-1.png" width="816" /></p>
<p>You may notice that the counties map does not seem complete; most notable is the absence of <em>all</em> Louisiana counties. Let’s look at the rows in <code>cnty.df1</code> associated with the state of Louisiana.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
<span class="kw">table</span>(<span class="kw">str_detect</span>(cnty.df1<span class="op">$</span>ID,  <span class="st">&quot;louisiana&quot;</span>) )</code></pre></div>
<pre><code>
FALSE 
 2971 </code></pre>
<p>There are no rows returned (i.e. all cases returned <code>FALSE</code>). This suggests that the Louisiana counties did not properly join. Let’s compare the Louisiana county names between <code>df1</code> and <code>cnty</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df1 <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(ID,  <span class="st">&quot;louisiana&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre></div>
<pre><code>                           ID B20004001
1     louisiana,acadia parish     28678
2      louisiana,allen parish     29870
3  louisiana,ascension parish     43464
4 louisiana,assumption parish     34269
5  louisiana,avoyelles parish     26483
6 louisiana,beauregard parish     33983</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnty <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(ID,  <span class="st">&quot;louisiana&quot;</span>)) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">head</span>()</code></pre></div>
<pre><code>Simple feature collection with 6 features and 1 field
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: -93.74163 ymin: 29.62765 xmax: -90.63619 ymax: 31.35225
epsg (SRID):    4326
proj4string:    +proj=longlat +datum=WGS84 +no_defs
                    ID                       geometry
1     louisiana,acadia MULTIPOLYGON (((-92.61863 3...
2      louisiana,allen MULTIPOLYGON (((-92.5957 30...
3  louisiana,ascension MULTIPOLYGON (((-91.12894 3...
4 louisiana,assumption MULTIPOLYGON (((-91.23207 3...
5  louisiana,avoyelles MULTIPOLYGON (((-92.32642 3...
6 louisiana,beauregard MULTIPOLYGON (((-93.12856 3...</code></pre>
<p>It turns out that Louisiana does not divide its administrative areas into <em>counties</em> but <em>parishes</em> instead. The income data (originally downloaded from the Census Bureau) follows through with that designation convention by adding the word “parish” to each of its administrative area names. We therefore need to remove all instances of <code>parish</code> in the <code>subregion</code> names associated with Louisiana. We will therefore need to recreate the <code>df1</code> object as follows:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(stringr)
df1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">inner_join</span>(st, <span class="dt">by=</span><span class="st">&quot;State&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">ID =</span> <span class="kw">paste</span>(region,<span class="kw">tolower</span>(County), <span class="dt">sep =</span> <span class="st">&quot;,&quot;</span>),
         <span class="dt">ID =</span> <span class="kw">ifelse</span>(region<span class="op">==</span><span class="st">&quot;louisiana&quot;</span>, 
                             <span class="kw">str_replace</span>(ID, <span class="st">&quot; parish&quot;</span>, <span class="st">&quot;&quot;</span>), ID))  <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(ID, B20004001 )</code></pre></div>
<p>Let’s re-join the dataframes and re-plot the map.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnty.df1 &lt;-<span class="st"> </span><span class="kw">inner_join</span>(cnty, df1, <span class="dt">by=</span><span class="st">&quot;ID&quot;</span> )

<span class="kw">tm_shape</span>(cnty.df1) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;B20004001&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Greens&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_legend</span>(<span class="dt">outside =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-16-1.png" width="816" /></p>
<p>Most of Louisiana’s parishes are now mapped, but we are still missing a few parishes as well as a few counties. This is a result of differences in spelling for two-word county and parish names. For example, <code>df1</code> encodes St. Lucie county (Florida) as <code>st. lucie</code> whereas <code>cnty</code> omits the dot and encodes it as <code>st lucie</code>. Fixing these discrepancies will require additional labor. At this point, it may prove more fruitful to do away with state/county names as <em>joining</em> keys and use <strong>FIPS</strong> county codes instead. FIPS (Federal Information Processing Standards) codes assign each county/state a unique five number designation thus making it easier to join data to spatial features. However, neither our census data table nor the built-in counties map have FIPS codes. We will download another version of the income data (one that has FIPS codes). Note that FIPS codes are normally part of datasets provided by the Census Bureau. The <code>maps</code> package has a dataset called <code>county.fips</code> that can be used to match state/county names in the <code>county</code> map to FIPS codes.</p>
</div>
<div id="joining-income-table-by-fips-code" class="section level2">
<h2>Joining income table by FIPS code</h2>
<p>Let’s download the FIPS version of the dataset. Note that we will not need to modify/add columns to the data since we will be joining this table to the county map using the FIPS code.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">df &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;http://mgimond.github.io/ES218/Data/Income_education_with_FIPS.csv&quot;</span>)
df1 &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(FIPS, B20004001 )</code></pre></div>
<p>Next, we’ll load the <code>county.fips</code> dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Load the county.fips dataset</span>
<span class="kw">data</span>(county.fips)
<span class="kw">head</span>(county.fips)</code></pre></div>
<pre><code>  fips        polyname
1 1001 alabama,autauga
2 1003 alabama,baldwin
3 1005 alabama,barbour
4 1007    alabama,bibb
5 1009  alabama,blount
6 1011 alabama,bullock</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnty2 &lt;-<span class="st"> </span>cnty <span class="op">%&gt;%</span>
<span class="st">         </span><span class="kw">left_join</span>(county.fips, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;ID&quot;</span> =<span class="st"> &quot;polyname&quot;</span>))</code></pre></div>
<p>Now that the FIPS codes are part of the county map dataframe, let’s join the income data table to the county map, then map the income values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnty2.df1 &lt;-<span class="st"> </span><span class="kw">inner_join</span>(cnty2, df1, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&quot;fips&quot;</span> =<span class="st"> &quot;FIPS&quot;</span>) )

<span class="kw">tm_shape</span>(cnty2.df1) <span class="op">+</span><span class="st"> </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;B20004001&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Greens&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_legend</span>(<span class="dt">outside =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-20-1.png" width="816" /></p>
<p>This is an improvement over the last map. But there are still a few counties missing. After a closer scrutiny of the data, it seems that the <code>county.fips</code> table splits some counties into two or more sub-regions. For example, Accomack county (Virginia) is split into two regions (and thus into two different names):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">county.fips <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(<span class="kw">str_detect</span>(polyname,  <span class="st">&quot;virginia,accomack&quot;</span>))</code></pre></div>
<pre><code>   fips                       polyname
1 51001         virginia,accomack:main
2 51001 virginia,accomack:chincoteague</code></pre>
<p>Fixing these discrepancies would require manual intervention and time. Another work around is to use the Census Bureau’s map files instead of <code>maps</code>’s built-in map. We will cover this in the next section.</p>
</div>
</div>
<div id="working-with-external-gis-files" class="section level1">
<h1>Working with external GIS files</h1>
<div id="reading-a-shapefile-into-r" class="section level2">
<h2>Reading a shapefile into R</h2>
<p>The Census Bureau maintains its own library of administrative boundary shapefiles (shapefiles are popular map data formats). This may prove to be the best map source to use since its areal units are designed to match the records in the income data table. Loading a shapefile can easily be accomplished using the <code>st_read()</code> function from the <code>sf</code> package. One option is to download the shapefile from the Census Bureau’s website (usually in a zipped format) then unpack it in a local project folder before reading it into the current session with <code>st_read()</code>. But we can maximize the replicability of the workflow by writing a chunk of code that will download the zipped shapefile into a temporary directory before unzipping it and loading the shapefile into an active R session as shown below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)

tmp &lt;-<span class="st"> </span><span class="kw">tempdir</span>()
link &lt;-<span class="st"> &quot;http://www2.census.gov/geo/tiger/GENZ2010/gz_2010_us_050_00_20m.zip&quot;</span>
filename &lt;-<span class="st"> </span><span class="kw">basename</span>(link)
<span class="kw">download.file</span>(link, filename)
<span class="kw">unzip</span>(filename, <span class="dt">exdir =</span> tmp )
shapefile &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="dt">dsn =</span> tmp, <span class="dt">layer =</span> tools<span class="op">::</span><span class="kw">file_path_sans_ext</span>(filename))</code></pre></div>
<pre><code>Reading layer `gz_2010_us_050_00_20m&#39; from data source `C:\Users\mgimond\AppData\Local\Temp\Rtmp003anP&#39; using driver `ESRI Shapefile&#39;
Simple feature collection with 3221 features and 6 fields
geometry type:  MULTIPOLYGON
dimension:      XY
bbox:           xmin: -179.1473 ymin: 17.88481 xmax: 179.7785 ymax: 71.35256
epsg (SRID):    4269
proj4string:    +proj=longlat +datum=NAD83 +no_defs</code></pre>
<p>The shapefile is unzipped into a temporary folder, <code>tmp</code>, then read from that same directory and stored in an <code>sf</code> object called <code>shapefile</code>. The code <code>tools::file_path_sans_ext(filename)</code> extracts the name of the zip file (minus the extension) which turns out to also be the name of the shapefile. Note that if the zip file was manually unpacked in a project folder then the only command that would have needed to be executed is the <code>st_read</code> function as in <code>st_read(&quot;gz_2010_us_050_00_20m.shp&quot; )</code>.</p>
<p>The Census shapefile has a field called <code>GEO_ID</code> that includes the county FIPS codes along with other superfluous county ID values. We only need the last five digit county FIPS code so we’ll extract these codes into a new column called <code>FIPS</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">shapefile<span class="op">$</span>FIPS &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">str_sub</span>(shapefile<span class="op">$</span>GEO_ID, <span class="dv">10</span>, <span class="dv">14</span>))</code></pre></div>
<p>Next we can append the income table to the <code>shapefile</code> object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cnty2.cs &lt;-<span class="st"> </span>shapefile <span class="op">%&gt;%</span>
<span class="st">            </span><span class="kw">inner_join</span>(df1, <span class="dt">by=</span><span class="st">&quot;FIPS&quot;</span>)</code></pre></div>
<p>Now, we can plot the income distribution map. Note that the Census Bureau shapefile includes the 48 states, Alaska and Hawaii. If you want to limit the extent to the 48 states, define the boundary limits using the <code>bbox</code> parameter in the <code>tm_shape</code> function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tm_shape</span>(cnty2.cs, 
         <span class="dt">bbox =</span> <span class="kw">st_bbox</span>(<span class="kw">c</span>(<span class="dt">xmin =</span> <span class="op">-</span><span class="dv">125</span>, <span class="dt">xmax =</span> <span class="op">-</span><span class="dv">67</span> , <span class="dt">ymin =</span> <span class="dv">25</span>, <span class="dt">ymax =</span> <span class="dv">50</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;B20004001&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Greens&quot;</span>, <span class="dt">title =</span> <span class="st">&quot;Income&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_legend</span>(<span class="dt">outside =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-25-1.png" width="816" /></p>
</div>
<div id="modifying-the-color-scheme" class="section level2">
<h2>Modifying the color scheme</h2>
<p>The classification scheme can be customized. For example, to split the income values across six intervals (e.g. $0 to $20000, $20000 to $30000, $30000 to $50000, and $50000 to $100000) and to label the values as dollars, type the following:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tm_shape</span>(cnty2.cs, 
         <span class="dt">bbox =</span> <span class="kw">st_bbox</span>(<span class="kw">c</span>(<span class="dt">xmin =</span> <span class="op">-</span><span class="dv">125</span>, <span class="dt">xmax =</span> <span class="op">-</span><span class="dv">67</span> , <span class="dt">ymin =</span> <span class="dv">25</span>, <span class="dt">ymax =</span> <span class="dv">50</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;B20004001&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;Greens&quot;</span>,
          <span class="dt">style=</span><span class="st">&quot;fixed&quot;</span>, <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">20000</span> , <span class="dv">30000</span>, <span class="dv">50000</span>, <span class="dv">100000</span> ),
          <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;under $20k&quot;</span>, <span class="st">&quot;$20k - $30k&quot;</span>, <span class="st">&quot;$30k - $50k&quot;</span>, <span class="st">&quot;above $50k&quot;</span>),
          <span class="dt">title =</span> <span class="st">&quot;Income&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_legend</span>(<span class="dt">outside =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-26-1.png" width="816" /></p>
<p>We might choose to map the income distribution using a <strong>divergent</strong> color scheme where we compare the counties to some overall value such as the counties’ median income value. We can use the <code>quantile()</code> function to break the income data into its percentiles. This will be helpful in generating symmetrical intervals about the median.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">inc.qt &lt;-<span class="st"> </span><span class="kw">quantile</span>(df1<span class="op">$</span>B20004001, <span class="dt">probs =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="fl">0.125</span>, .<span class="dv">25</span>, <span class="fl">0.5</span>, .<span class="dv">75</span>, .<span class="dv">875</span> , <span class="dv">1</span> ))</code></pre></div>
<p>A divergent color scheme consists of two different hues whose lightness values converge towards some central value (the median income in our case). We’ll use a red-to-green color palette, <code>RdYlGn</code>, for this next map where red hues highlight counties below the county median income and green hues highlight counties above the county median value.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">tm_shape</span>(cnty2.cs,
         <span class="dt">bbox =</span> <span class="kw">st_bbox</span>(<span class="kw">c</span>(<span class="dt">xmin =</span> <span class="op">-</span><span class="dv">125</span>, <span class="dt">xmax =</span> <span class="op">-</span><span class="dv">67</span> , <span class="dt">ymin =</span> <span class="dv">25</span>, <span class="dt">ymax =</span> <span class="dv">50</span>))) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_fill</span>(<span class="dt">col =</span> <span class="st">&quot;B20004001&quot;</span>, <span class="dt">palette =</span> <span class="st">&quot;RdYlGn&quot;</span>,
          <span class="dt">style=</span><span class="st">&quot;fixed&quot;</span>, <span class="dt">breaks =</span> inc.qt,
          <span class="dt">title =</span> <span class="st">&quot;Income&quot;</span>) <span class="op">+</span>
<span class="st">  </span><span class="kw">tm_legend</span>(<span class="dt">outside =</span> <span class="ot">TRUE</span>) </code></pre></div>
<p><img src="Week12a_files/figure-html/unnamed-chunk-28-1.png" width="816" /></p>
<p>The divergent map gives us a different handle on the data. Here, we can identify the poorer than average counties such as the southeast and parts of the Mississippi river region as well as the wealthier counties such as the mid-atlantic region and the west coast.</p>
</div>
</div>


<div class="footer">
<hr/>
<a rel="license" href="https://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/80x15.png" /></a>  Manny Gimond (2019)
</br>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
