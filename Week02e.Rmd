---
title: "Week2: Manipulating dataframes"
output:
  html_document:
    toc: yes
    toc_depth: 3
  word_document: default
---

```{r echo=FALSE}
source("libs/Common.R")
```

The data file  *FAO_grains_NA.csv* will be used in this exercise. This dataset consists of grain yield and harvest year by north american country. The dataset was downloaded from http://faostat3.fao.org/ in June of 2014. 

Run the following line to load the FAO data file into your current R session.

```{r}
dat <- read.csv("http://mgimond.github.io/ES218/Data/FAO_grains_NA.csv", header=TRUE)
```


Let's look at the data structure. This provides us insight into each column's data type (remember that each column can be thought of as a unique vector object).

```{r out.height=5}
str(dat)
```

You will notice that when the CSV file is imported (and automatically stored as a data frame), R makes an attempt at identifying the data type. For example, the columns Year and Value are defined as numeric (Year is identified as an integer which is a whole number), but all other fields are identified as being factors and not characters. This is because R recognizes that many values in these fields are repeated many times. For example, the field `Country` has just two unique values: `Canada` and `United States of America`. Country is thus a **two level factor**. Likewise, the field `Crop` consists of just 11 unique values which makes it an **eleven level factor**. 

It may be useful to list the set of unique levels in a factor (factors can be thought of as categories). For example, to list the unique crop levels in our data frame, call the `unique` function`:

```{r}
unique(dat$Crop)
```

We can also tally the number of rows associated with each unique factor:

```{r}
table(dat$Crop)
```

## Changing data type

If you don't agree with how R defines a column data type, you can easily convert the column to a different data type. For example, if we don't want the `Source` column defined as a Factor but as a Character instead, we use the `as.character` function.

```{r}
dat$Source <- as.character(dat$Source)
```

Note that `str(dat)` reflects the change in the `Source`'s data type; it's now listed as `chr` instead of `Factor`.

You can convert to other data types by using functions such as `as.factor`, `as.integer`, `as.numeric` and `as.Date` to name a few. 

## Substituting values using `ifelse`

Columns can be added to data frames using the assignment operator `<-`. For example, we might want to create a new column called `Cntr` and assign it an abbreviate version of the country name.

```{r}
dat$Cntr <- ifelse( dat$Country == "Canada", yes="CAN", no="USA")
```

The `ifelse` function allows us to assign a condition to the assigned value in the newly created column, `Cntr`, based on the value in row `Country`. If the value in the `Country` field is `Canada` then the value in the `Cntr` field will be `Can`; if not, the value will be `USA`.

Also note the use of the double equality sign ,`==` , which indicates that we are checking for equality between two values and not assigning the value "Canada" to `dat$Country`. Recall that `Logical` is one of many data types recognized by R. If you type the condition `dat$Country == "Canada"` at a command prompt, you will see that R returns a list of `TRUE`'s and `FALSE`'s for each record in `dat$Country`.


